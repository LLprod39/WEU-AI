# WEU AI Agent Platform

Веб-платформа для работы с AI-агентами: чат с разными моделями, RAG, воркфлоу, задачи, пароли, серверы — всё в одном месте.

---

## Что это и для кого

Единый веб-интерфейс, где можно общаться с AI (Gemini, Grok), подключать базу знаний, запускать агентов по сценариям и вести задачи. Удобно командам, которые уже используют LLM и хотят не размазывать всё по скриптам, а собрать в один рабочий стол: чат, оркестратор, агенты, таски, доступ к серверам и паролям из одного аккаунта.

---

## Что внутри

**Чат и модели**  
Один чат, переключение провайдеров (Gemini / Grok) и моделей. RAG включается кнопкой — ответы опираются на загруженные документы. Модели и ключи настраиваются в интерфейсе и через `.env`.

**Оркестратор**  
Экран с цепочкой «мысль → действие → ответ»: видно, какие инструменты вызываются, что отвечает модель. Подходит и для отладки сценариев, и для демо.

**Агенты и воркфлоу**  
Профили агентов (модель, RAG, тип агента), проекты как рабочие папки и воркфлоу — сценарии из нескольких шагов. Запуск и Cursor CLI, и Ralph из браузера; логи и статусы по запускам в одном разделе.

**База знаний (RAG)**  
Загрузка файлов и текста, поиск по ним при включённом RAG в чате. Бэкенд — Qdrant (Docker) или InMemory, если не хочешь поднимать векторную БД.

**Задачи**  
Приоритеты, метки, комментарии, вложения, подзадачи. Есть AI: анализ формулировки, улучшение описания, разбиение на подзадачи. К задачам можно привязать обсуждение в чате.

**Пароли и серверы**  
Пароли — шифрование AES-256, категории, генератор. Серверы — SSH-хосты, группы, проверка подключения и выполнение команд. Удобно держать рядом с агентами и задачами, без отдельных инструментов.

**Инструменты агентов**  
Файловая система, SSH на серверы, веб-запросы и скрапинг. Всё это доступно оркестратору и внешним рантаймам (Cursor, Ralph).

**MCP**  
Клиент Model Context Protocol — можно подключать внешние тулы через `mcp_config.json` (filesystem, postgres и т.п.), если нужно расширять агентов.

---

## Зачем так делать

- **Один вход** — логин в веб, дальше чат, агенты, задачи, пароли, серверы без переключения между сервисами.
- **Гибкость моделей** — смена провайдера и модели без правки кода, всё через UI и конфиг.
- **RAG по желанию** — включил в чате, загрузил документы — ответы уже с опорой на твои данные.
- **Воркфлоу из коробки** — многошаговые сценарии, запуск Cursor/Ralph, просмотр логов и остановка из интерфейса.
- **Задачи с AI** — не только трекер, но и помощь по формулировкам и разбиению на шаги.
- **Без лишней инфраструктуры** — для MVP рекомендуется PostgreSQL (Docker), чтобы при многих подключениях и агентах не упираться в блокировки SQLite. Опционально Docker только для Qdrant. Для быстрого ознакомления можно оставить SQLite.

---

## Две сборки: mini и full

- **Mini (по умолчанию)** — для тестов и быстрого старта: без PyTorch, без моделей RAG, без тяжёлых зависимостей. Чат, задачи, агенты, пароли, серверы работают; RAG отключён.
- **Full** — всё из mini плюс RAG (sentence-transformers, эмбеддинги), Qdrant, OCR, DOCX, расширенный PDF.

Подробнее: [docs/BUILDS.md](docs/BUILDS.md).

---

## Быстрый старт

**Требования:** Python 3.10+, при желании Docker.

### Один запуск в Docker

```bash
docker compose up --build
```

Открой `http://localhost:8000`. При первом старте автоматически создаётся суперпользователь **admin** / **admin** (логин/пароль можно переопределить в `.env`: `DJANGO_SUPERUSER_USERNAME`, `DJANGO_SUPERUSER_PASSWORD`). Для продакшена обязательно задай свои значения.

Стартуют postgres, qdrant, web и **agent-runner** (контейнер для запуска агентов Cursor CLI / Ralph; общий volume `agent_projects_data`).

По умолчанию используется **mini**-сборка. Для RAG и эмбеддингов: `WEU_BUILD=full docker compose up --build` или задай в `.env` строку `WEU_BUILD=full`.

### Локально (без Docker)

```bash
git clone https://github.com/LLprod39/WEU-AI.git
cd WEU-AI
python -m venv venv
# Windows: venv\Scripts\activate
# Linux/macOS: source venv/bin/activate
pip install -r requirements.txt
```

По умолчанию ставится **mini**. Для RAG: `pip install -r requirements-full.txt`.

В корне создай `.env`:

```env
GEMINI_API_KEY=your_gemini_key
GROK_API_KEY=your_grok_key
```

База данных и пользователь:

- **Рекомендуется для MVP:** поднять PostgreSQL: `docker compose up -d postgres`, в `.env` задать `POSTGRES_HOST=localhost` и `POSTGRES_PASSWORD=...` (подробнее — [docs/DATABASE.md](docs/DATABASE.md)).
- Без Docker используется SQLite (`db.sqlite3`).

Миграции и суперпользователь:

```bash
python manage.py migrate
python manage.py createsuperuser
```

Запуск:

```bash
python manage.py runserver
```

Открой `http://127.0.0.1:8000`, залогинься под созданным пользователем — дальше чат, разделы в боковой панели и онбординг при первом заходе (один раз, потом не грузит).

Подробнее: [QUICK_START.md](QUICK_START.md).

---

## Что куда ставить

| Раздел           | Назначение |
|------------------|------------|
| **Chat**         | Чат, выбор провайдера/модели, RAG, загрузка файлов |
| **Orchestrator** | Цепочка ReAct и вызовы инструментов |
| **Knowledge Base** | Документы для RAG |
| **Agents**       | Профили, проекты, воркфлоу, запуски |
| **Tasks**        | Задачи, приоритеты, метки, AI-помощник |
| **Servers**      | SSH-хосты, группы, команды |
| **Passwords**    | Пароли, категории, генератор |
| **Settings**     | Провайдер по умолчанию, модели, ключи (часть — в `.env`) |

---

## Конфиг и переменные

Основное — в `.env`: `GEMINI_API_KEY`, `GROK_API_KEY`. По желанию: `DJANGO_PORT`, `NICEGUI_PORT`, `CLI_RUNTIME_TIMEOUT_SECONDS`, `CURSOR_CLI_PATH`, `RALPH_CLI_PATH`.

**Cursor CLI в Docker без входа по Google:** добавь в `.env` строку `CURSOR_API_KEY=...`. Ключ создаётся в Cursor → Settings → API Access (или Dashboard → Background Agents). Тогда агенты Cursor CLI работают headless, без интерактивного логина. Бинарник `agent` при сборке образа ставится автоматически ([cursor.com/install](https://cursor.com/install)); для воркфлоу «orchestrate via Cursor CLI» достаточно `CURSOR_API_KEY`. Если установка в образе не сработала — см. [docs/CURSOR_CLI_DOCKER.md](docs/CURSOR_CLI_DOCKER.md) (CURSOR_CLI_PATH и volume).

Для Cursor CLI из-под прокси/ограничений по HTTP/2 можно включить режим HTTP/1 в настройках Django: `CURSOR_CLI_HTTP_1=1` (по умолчанию уже включён), подробности в `web_ui/settings.py`.

Модели для чата и агентов задаются в Settings и при первом выборе сохраняются в `.model_config.json`.

---

## Документация в репо

- [QUICK_START.md](QUICK_START.md) — установка и первый запуск  
- [docs/BUILDS.md](docs/BUILDS.md) — две сборки (mini / full), когда что ставить  
- [docs/CURSOR_CLI_DOCKER.md](docs/CURSOR_CLI_DOCKER.md) — Cursor CLI в Docker без входа по Google (CURSOR_API_KEY)  
- [docs/DATABASE.md](docs/DATABASE.md) — PostgreSQL для MVP, разделение нагрузки  
- [PROJECT_STRUCTURE.md](PROJECT_STRUCTURE.md) — структура каталогов  
- [docs/ARCHITECTURE.md](docs/ARCHITECTURE.md) — как устроен выбор моделей и оркестрация  
- [docs/UI_GUIDE.md](docs/UI_GUIDE.md) — интерфейс и настройки моделей  

---

## Ограничения (честно)

- История чата не персистится между перезапусками сервера.
- RAG общий на всех пользователей, без изоляции по юзерам.
- В интерфейсе местами смешение русского и английского.

Если что-то ломается или неочевидно — лучше открыть Issue: так проще и тебе, и тем, кто будет подключаться потом.

---

## Лицензия и контрибьюция

Лицензия и правила контрибьюции — уточняются. Исходный код открыт для ознакомления и доработок под свои процессы.
