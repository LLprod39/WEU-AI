# WEU AI Agent Platform — возможности и фичи веба

**Версия:** 2.0.0 — DevOps/IT Edition  
**Стек:** Django 5.2, Daphne (ASGI), PostgreSQL/SQLite, Qdrant, Redis

Платформа — это единый веб-интерфейс для автоматизации DevOps/IT: чат с AI, управление задачами (в стиле Jira), SSH-серверы, агенты, база знаний (RAG), менеджер паролей и разграничение доступа.

---

## Что делает веб в целом

- **Чат с AI** — общение с моделями (Gemini/Grok), стриминг ответов, загрузка файлов, выбор моделей.
- **Оркестрация** — ReAct-цикл (мысль → действие → наблюдение), прозрачные вызовы инструментов.
- **Задачи** — проекты, спринты, команды, доски, AI-анализ, уведомления, делегирование AI.
- **Серверы** — список SSH-серверов, выполнение команд, интерактивный терминал по WebSocket.
- **Агенты** — профили, воркфлоу, запуск Cursor/Claude Code/Ralph в headless-режиме.
- **База знаний (RAG)** — загрузка документов, семантический поиск (Qdrant или InMemory).
- **Пароли** — хранение учётных данных с AES-256 шифрованием, категории и теги.
- **Доступ** — пользователи, группы, права на задачи/серверы/воркфлоу.

Всё доступно через браузер: десктоп и мобильные шаблоны, API для чата, задач, RAG, агентов и т.д.

---

## Крутые фичи по разделам

### 1. Чат и оркестрация

| Фича | Описание |
|------|----------|
| **Мульти-провайдер LLM** | Gemini и Grok под одним API, переключение моделей в чате. |
| **Стриминг ответов** | Ответы приходят по кускам в реальном времени. |
| **Режимы оркестратора** | ReAct (инструменты + рассуждение), Ralph Internal, Ralph CLI. |
| **Несколько чат-сессий** | Список чатов, создание нового, история сообщений по сессии. |
| **Загрузка файлов в чат** | Файлы передаются в контекст LLM. |
| **Визуализация ReAct** | На странице Orchestrator видно: мысль → действие → результат. |
| **Выбор моделей** | В UI доступны chat_model и agent_model для Gemini/Grok. |

### 2. Инструменты (Tools)

Агент может вызывать их в рамках ReAct-цикла:

| Категория | Инструменты |
|-----------|--------------|
| **SSH** | `ssh_connect`, `ssh_execute`, `ssh_disconnect` — подключение и выполнение команд на серверах. |
| **Серверы** | `servers_list`, `server_execute` — список серверов пользователя и выполнение команд (с учётом прав). |
| **Файловая система** | `read_file`, `write_file`, `list_directory`, `create_directory`, `delete_file` — локальные файлы (с разрешениями). |
| **Задачи** | `tasks_list`, `task_detail` — список задач и детали задачи для контекста AI. |
| **Веб** | `web_search`, `fetch_webpage` — поиск и загрузка страниц. |
| **MCP** | Подключение внешних MCP-серверов, их инструменты попадают в общий пул. |

**Безопасность:** блокировка опасных команд (`rm -rf`, `mkfs`, `dd if=`, `shutdown`, `reboot`, `systemctl stop/disable/mask`, `truncate -s 0` и т.п.) через `app/tools/safety.py`.

### 3. Задачи (Tasks) — Jira-подобная система

| Фича | Описание |
|------|----------|
| **Проекты** | Группировка задач по проектам, ключ проекта (WEU, DEV), цвет и иконка. |
| **Роли в проекте** | Owner, Admin, Member, Viewer; приглашения по email, принятие по ссылке. |
| **Команды (Teams)** | Группы пользователей; команду можно добавить в проект целиком. |
| **Спринты** | Планирование, активный, завершённый спринт; задачи в бэклоге и в спринте. |
| **Доска и бэклог** | Kanban по статусам, бэклог проекта, перемещение задач между спринтами. |
| **Ключи задач** | Автогенерация ключей вида WEU-123. |
| **Иерархия** | Epic → Story → Task (parent_task / child_tasks). |
| **Наблюдатели** | Подписка на задачу, уведомления об обновлениях. |
| **Назначение на команду** | Поле assigned_team в дополнение к assignee. |
| **Материалы проекта** | Документы, ссылки, файлы, wiki-страницы в проекте. |
| **Сохранённые фильтры** | Сохранение фильтров и видов списка задач. |
| **Массовые операции** | Bulk-действия по выбранным задачам. |
| **Связи между задачами** | Связывание задач (link/unlink). |

**AI в задачах:**

| Фича | Описание |
|------|----------|
| **Умный анализатор** | Извлечение упоминаний серверов из текста, сопоставление с базой серверов, оценка возможности авто-выполнения. |
| **Разбиение на подзадачи** | AI предлагает подзадачи с таймингами. |
| **Рекомендация агента** | Рекомендуемый кастомный агент или тип (react, simple, complex, ralph). |
| **Делегирование AI** | Задача может быть назначена на ИИ с подтверждением пользователя. |
| **Улучшение описания** | AI улучшает формулировку задачи. |
| **Воркфлоу из задачи** | Создание воркфлоу агента из задачи (api_workflow_from_task). |

**Уведомления:**

- Внутри платформы: приглашение в проект, смена роли, назначение задачи, перемещение задачи, обновления для наблюдателей, старт/завершение спринта, упоминания в комментариях (@username).
- Email: приглашение в проект, назначение задачи, упоминание в комментарии (шаблоны в `tasks/templates/tasks/emails/`).

### 4. Серверы (SSH)

| Фича | Описание |
|------|----------|
| **Список серверов** | Имя, хост, порт, группа; фильтрация по пользователю и правам. |
| **Группы серверов** | Группы, подписка пользователя на группу, добавление/удаление участников. |
| **Выполнение команд** | API выполнение команды на выбранном сервере (с проверкой безопасности). |
| **Интерактивный терминал (WebSocket)** | Полноценная SSH-сессия в браузере: ввод, вывод, resize. |
| **Multi-terminal hub** | Несколько терминалов в одном интерфейсе. |
| **AI в терминале** | В том же WebSocket: запрос к AI по текущему контексту, предложение команд с подтверждением (ai_request, ai_confirm, ai_cancel). |
| **Шифрование паролей** | Пароли серверов хранятся зашифрованными (AES-256), расшифровка по MASTER_PASSWORD. |

### 5. Агенты и воркфлоу (Agent Hub)

| Фича | Описание |
|------|----------|
| **Профили агентов** | Настройки агента (модель, режим, аргументы). |
| **Воркфлоу** | JSON-скрипты шагов; импорт/экспорт, генерация из задачи. |
| **Запуск воркфлоу** | Запуск Cursor / Claude Code / Ralph в headless с stream-json. |
| **Управление запуском** | Статус, стоп, рестарт, пропуск шага, retry шага, продолжение. |
| **Кастомные агенты** | Создание агентов через веб: имя, тип, разрешённые серверы, экспорт. |
| **MCP** | Подключение MCP-серверов, список инструментов; отдельный mcp_server.py для быстрого старта при интеграции с Claude Code. |
| **Логи запусков** | Просмотр логов прогонов агентов и воркфлоу. |

**Режимы CLI:**

- **Cursor** — agent и plan; `--output-format stream-json`, модель принудительно `auto`.
- **Claude Code** — флаги `-p`, `--verbose`, `--output-format stream-json`, `--dangerously-skip-permissions`, `--debug mcp`.
- **Ralph** — внутренний режим (итеративные вызовы LLM) или внешний CLI.

### 6. База знаний (RAG)

| Фича | Описание |
|------|----------|
| **Загрузка документов** | Добавление текста/документов в коллекцию (api/rag/add). |
| **Семантический поиск** | Поиск по смыслу (api/rag/query); эмбеддинги — paraphrase-multilingual-MiniLM-L12-v2. |
| **Бэкенды** | Qdrant (внешний векторный БД) или InMemory (без внешних зависимостей). |
| **Список документов / сброс** | api/rag/documents, api/rag/reset, api/rag/delete. |
| **Мини-сборка** | Без sentence-transformers и тяжёлых моделей RAG недоступен; полная сборка — requirements-full.txt. |

### 7. Менеджер паролей (Passwords)

| Фича | Описание |
|------|----------|
| **Учётные записи** | Имя, логин, email, URL, пароль (в зашифрованном виде). |
| **AES-256** | Шифрование паролей и соли; ключ из MASTER_PASSWORD. |
| **Категории и теги** | CredentialCategory, CredentialTag для организации. |
| **Поиск и фильтры** | По категории, поиск по имени/логину/email/URL. |
| **Мобильный шаблон** | Отдельный список для мобильных устройств. |

### 8. Настройки и доступ

| Фича | Описание |
|------|----------|
| **Настройки приложения** | Модели, провайдер, параметры через api/settings и UI. |
| **Управление пользователями** | Список пользователей, смена пароля (api/access/users). |
| **Группы** | Группы пользователей, участники (api/access/groups). |
| **Права (Permissions)** | Разграничение прав на задачи, серверы, воркфлоу (app/services/permissions.py). |
| **Настройки проекта** | Отдельная страница настроек проекта (ключ, участники, материалы и т.д.). |
| **Настройки выполнения задач** | Страница execution settings для задач (таймауты, поведение AI и т.п.). |
| **Диск** | api/disk — отчёт о использовании диска. |
| **Health** | api/health — статус приложения и сервисов (в т.ч. RAG) без авторизации. |

### 9. Дополнительные страницы и API

| Страница/API | Назначение |
|--------------|------------|
| **Dashboard** | Сводка: серверы, задачи, запуски агентов, воркфлоу; api/dashboard/stats для обновления. |
| **Monitor** | Страница мониторинга (monitor_view). |
| **Knowledge Base** | UI для базы знаний (RAG). |
| **IDE** | Просмотр/редактирование файлов (api/ide/files, api/ide/file, ide_view). |
| **Welcome** | Публичная посадочная страница (без авторизации). |
| **Docs UI Guide** | Документация по интерфейсу (docs/ui-guide). |
| **Мобильные шаблоны** | base, chat, knowledge_base, login, settings, списки задач и серверов, терминал — в подпапках mobile/. |

### 10. Интеграции

| Интеграция | Описание |
|------------|----------|
| **Jira** | JiraConnector: синхронизация по JQL, импорт задач, обновление статусов и комментариев (JIRA_URL, JIRA_API_TOKEN, JIRA_EMAIL). |
| **MCP** | Клиент MCP в app/mcp; отдельный mcp_server.py с инструментами server_execute, servers_list для Claude Code. |

### 11. Безопасность и изоляция

- **Пользовательская изоляция** — серверы, задачи, пароли, чаты привязаны к user.
- **Проверка прав** — перед выполнением команд на сервере, просмотром задачи, запуском воркфлоу (Permission Service).
- **Блокировка опасных команд** — проверка перед выполнением по SSH (safety.py).
- **Шифрование паролей** — серверы и менеджер паролей используют MASTER_PASSWORD.

---

## Краткая схема «что где лежит»

| Что | Где в коде |
|-----|------------|
| Чат, дашборд, настройки, RAG API, доступ | core_ui/views.py, core_ui/urls.py |
| Задачи, проекты, спринты, команды, уведомления | tasks/views.py, tasks/project_views.py, tasks/team_views.py, tasks/urls.py |
| Серверы, терминал WebSocket | servers/views.py, servers/consumers.py, servers/routing.py |
| Агенты, воркфлоу, MCP API | agent_hub/views, agent_hub/views_legacy.py |
| Оркестратор, ReAct, режимы | app/core/unified_orchestrator.py, app/core/modes/ |
| Инструменты | app/tools/ (manager, ssh_tools, server_tools, tasks_tools, filesystem_tools, web_tools, safety) |
| RAG | app/rag/engine.py, app/rag/inmemory_rag.py |
| Jira | app/integrations/jira_connector.py |
| Пароли | passwords/views.py, passwords/encryption.py |
| Уведомления | tasks/notification_triggers.py, tasks/email_service.py |

---

## Сборки

- **Mini** (`requirements.txt`, WEU_BUILD=mini): без PyTorch и тяжёлых RAG-моделей, быстрый старт.
- **Full** (`requirements-full.txt`, WEU_BUILD=full): sentence-transformers, полный RAG.

Веб работает в обоих вариантах; в mini RAG API возвращает заглушки или сообщения о недоступности.

---

Этот файл можно использовать как обзор возможностей платформы для команды или документации продукта.
