# Визуальное руководство по интерфейсу и модулям

## Модули static/js и паттерны

Подключаются через `base.html` (общие) или в шаблонах страниц (страничные).

### Общие модули (base)

| Модуль | Назначение |
|--------|------------|
| **toast.js** | `window.showToast(message, type?, duration?, actionUrl?)` — тосты. Единственный источник; страницы только вызывают его. |
| **common.js** | `window.getCookie(name)` — чтение cookies (CSRF и др.). Используется в settings, rag_ui, agent_hub. |
| **app_shell.js** | Sidebar toggle, mobile overlay, health (`/api/health`), UI settings (theme/density/size/animations), восстановление состояния из localStorage. |
| **onboarding.js** | Тур по интерфейсу, `window.OnboardingTour`. |

### Страничные модули

| Модуль | Страница | Назначение |
|--------|----------|------------|
| **validate.js** | Settings | `window.SettingsValidation`: `setOptions({apiKeyIds, requiredFieldIds, rag})`, `validateAllRequired()`, `setupValidation()`. Валидация полей без дублирования в шаблоне. |
| **tasks_ui.js** | Tasks | Drag/drop колонок, AI Improve/Breakdown, `validateCreateTaskForm`, тосты через `window.showToast`. |
| **rag_ui.js** | Knowledge Base | RAGUI: документы, фильтры, поиск, модалки. Использует `window.showToast`, `window.getCookie`. |
| **agent_hub.js** | Agents | Профили, workflow, Task Builder, импорт/экспорт. Использует `window.showToast`, `window.getCookie`. |

### Паттерны

1. **Тосты** — везде только `window.showToast(...)`. Локальных обёрток и копий нет.
2. **CSRF** — `window.getCookie('csrftoken')` из `common.js`; в формах и fetch заголовок `X-CSRFToken`.
3. **Sidebar / health** — только в `app_shell.js`; в шаблонах нет дублирования логики.
4. **Валидация форм** — общая логика в `validate.js`; страница Settings передаёт конфиг в `SettingsValidation.setOptions()` и вызывает `validateAllRequired()` перед отправкой, `setupValidation()` при загрузке.
5. **Стили** — общие и крупные блоки в `core_ui/static/css/style.css` (в т.ч. corporate-chat, kb-*, .filter-btn.active, .tool-toggle). В шаблонах остаются только комментарии-указатели на style.css.

---

## 1. Интерфейс чата

```
┌─────────────────────────────────────────────────────────────────┐
│ Настройки: [Провайдер ▼ gemini] [Модель ▼ gemini-2.0-flash-exp] │
│            [RAG ☑]                                     [🗑️]      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  🤖 WEU Agent:                                                  │
│  Привет! Я ваш AI ассистент...                                 │
│                                                                 │
│                                              👤 Пользователь:  │
│                                              Привет!            │
│                                                                 │
│  🤖 WEU Agent:                                                  │
│  Здравствуйте! Чем могу помочь?                                │
│                                                                 │
├─────────────────────────────────────────────────────────────────┤
│ [Введите сообщение...]                                    [📤]  │
└─────────────────────────────────────────────────────────────────┘
```

### Элементы управления:

1. **Провайдер** - Выбор между Gemini и Grok
   - При смене провайдера автоматически обновляется список моделей
   
2. **Модель** - Выбор конкретной модели
   - Показывает только модели выбранного провайдера
   - Сохраняется для текущей сессии
   
3. **RAG** - Включение базы знаний
   - Добавляет контекст из векторной БД

## 2. Настройки - Вкладка "Модели"

```
┌─────────────────────────────────────────────────────────────────┐
│ ⚙️ Настройки                                          [🔄]      │
├─────────────────────────────────────────────────────────────────┤
│ [API Ключи] [Модели] ◄── Активная вкладка                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ Выбор моделей для разных задач                                 │
│ 💡 Вы можете использовать разные модели для чата, агентов и RAG│
│                                                                 │
│ ▼ 🤖 Gemini Models                                              │
│   ┌───────────────────────────────────────────────────────────┐ │
│   │ Выберите модели Gemini для разных целей                  │ │
│   │                                                           │ │
│   │ 💬 [Модель для чата ▼ gemini-2.0-flash-exp]              │ │
│   │    Используется для обычных диалогов в чате              │ │
│   │                                                           │ │
│   │ 🤖 [Модель для агента ▼ gemini-2.0-flash-exp]            │ │
│   │    Используется для выполнения задач с инструментами     │ │
│   └───────────────────────────────────────────────────────────┘ │
│                                                                 │
│ ▶ 🚀 Grok Models                                                │
│                                                                 │
│ ▶ 📚 RAG / Embeddings                                           │
│                                                                 │
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ Провайдер по умолчанию                                      │ │
│ │ ⚙️ [Провайдер по умолчанию ▼ gemini]                        │ │
│ │    Используется при запуске приложения                      │ │
│ └─────────────────────────────────────────────────────────────┘ │
│                                                                 │
│                                          [Отмена] [💾 Сохранить]│
└─────────────────────────────────────────────────────────────────┘
```

## 3. Примеры использования

### Пример 1: Быстрый чат с переключением модели

```
1. Открыть чат
2. Выбрать провайдер: Gemini
3. Выбрать модель: gemini-2.0-flash-exp
4. Написать сообщение
5. Получить быстрый ответ

Переключение:
6. Выбрать провайдер: Grok
7. Модель автоматически меняется на: grok-4-latest
8. Написать сообщение
9. Получить ответ от Grok
```

### Пример 2: Настройка для разных задач

```
Открыть настройки → Модели

Gemini Models:
  💬 Чат: gemini-1.5-flash (быстрая)
  🤖 Агент: gemini-1.5-pro (мощная)

Grok Models:
  💬 Чат: grok-4-latest
  🤖 Агент: grok-4-1-fast-reasoning

RAG:
  📚 paraphrase-multilingual-MiniLM-L12-v2 (локальная)

Провайдер по умолчанию: gemini

Сохранить → Настройки применены!
```

## 4. Индикаторы и уведомления

### При смене провайдера:
```
ℹ️ Провайдер изменен на grok
```

### При смене модели:
```
ℹ️ Модель изменена на grok-4-latest
```

### При обновлении списка моделей:
```
ℹ️ Загрузка доступных моделей...
✅ Модели загружены!
```

### При сохранении настроек:
```
✅ Настройки сохранены!
```

## 5. Цветовая схема

- **Gemini**: Фиолетовый/Синий (`color=primary`)
- **Grok**: Оранжевый/Красный (`color=secondary`)
- **RAG**: Зеленый (`color=emerald`)
- **Иконки**: Соответствующие цвета для каждого типа

## 6. Горячие клавиши (будущее)

- `Ctrl+P` - Открыть выбор провайдера
- `Ctrl+M` - Открыть выбор модели
- `Ctrl+R` - Переключить RAG
- `Ctrl+,` - Открыть настройки
