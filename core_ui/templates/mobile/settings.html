{% extends 'mobile/base.html' %}

{% block title %}Настройки - WEU AI{% endblock %}
{% block header_title %}Настройки{% endblock %}

{% block content %}
<div class="mobile-page" id="mobile-settings-page">
    
    <!-- Model Settings -->
    <div class="mobile-settings-section">
        <div class="mobile-settings-section-title">Модели</div>
        
        <div class="mobile-settings-item">
            <div class="mobile-settings-item-content">
                <span class="mobile-settings-item-label">Провайдер по умолчанию</span>
                <span class="mobile-settings-item-value" id="settings-provider">—</span>
            </div>
            <span class="material-icons-round mobile-settings-item-arrow">chevron_right</span>
        </div>
        
        <div class="mobile-settings-item">
            <div class="mobile-settings-item-content">
                <span class="mobile-settings-item-label">Режим Cursor</span>
                <span class="mobile-settings-item-value" id="settings-cursor-mode">—</span>
            </div>
            <span class="material-icons-round mobile-settings-item-arrow">chevron_right</span>
        </div>
    </div>
    
    <!-- API Keys Status -->
    <div class="mobile-settings-section">
        <div class="mobile-settings-section-title">API ключи</div>
        
        <div class="mobile-settings-item">
            <div class="mobile-settings-item-icon">
                <span class="material-icons-round">key</span>
            </div>
            <div class="mobile-settings-item-content">
                <span class="mobile-settings-item-label">Gemini API</span>
            </div>
            <span class="mobile-settings-status" id="settings-gemini-status">—</span>
        </div>
        
        <div class="mobile-settings-item">
            <div class="mobile-settings-item-icon">
                <span class="material-icons-round">key</span>
            </div>
            <div class="mobile-settings-item-content">
                <span class="mobile-settings-item-label">Grok API</span>
            </div>
            <span class="mobile-settings-status" id="settings-grok-status">—</span>
        </div>
    </div>
    
    <!-- Other Settings -->
    <div class="mobile-settings-section">
        <div class="mobile-settings-section-title">Другое</div>
        
        <div class="mobile-settings-item" onclick="location.href='{% url 'settings_access' %}'">
            <div class="mobile-settings-item-icon">
                <span class="material-icons-round">group</span>
            </div>
            <div class="mobile-settings-item-content">
                <span class="mobile-settings-item-label">Управление доступом</span>
                <span class="mobile-settings-item-desc">Пользователи и права</span>
            </div>
            <span class="material-icons-round mobile-settings-item-arrow">chevron_right</span>
        </div>
    </div>
    
    <!-- App Info -->
    <div class="mobile-settings-section">
        <div class="mobile-settings-section-title">О приложении</div>
        
        <div class="mobile-settings-info">
            <div class="mobile-settings-info-row">
                <span>Версия</span>
                <span>1.0.0</span>
            </div>
            <div class="mobile-settings-info-row">
                <span>Платформа</span>
                <span>Django + Tailwind</span>
            </div>
        </div>
    </div>
</div>

<style>
    .mobile-settings-section {
        margin-bottom: 24px;
    }
    
    .mobile-settings-section-title {
        font-size: 12px;
        font-weight: 600;
        color: var(--mobile-text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 0 4px;
        margin-bottom: 8px;
    }
    
    .mobile-settings-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 14px 16px;
        background: var(--mobile-bg-surface);
        border-radius: var(--mobile-radius-md);
        margin-bottom: 2px;
        cursor: pointer;
        transition: var(--mobile-transition-fast);
    }
    
    .mobile-settings-item:first-of-type {
        border-radius: var(--mobile-radius-md) var(--mobile-radius-md) 0 0;
    }
    
    .mobile-settings-item:last-of-type {
        border-radius: 0 0 var(--mobile-radius-md) var(--mobile-radius-md);
        margin-bottom: 0;
    }
    
    .mobile-settings-item:only-of-type {
        border-radius: var(--mobile-radius-md);
    }
    
    .mobile-settings-item:active {
        background: var(--mobile-bg-elevated);
    }
    
    .mobile-settings-item-icon {
        width: 36px;
        height: 36px;
        border-radius: var(--mobile-radius-md);
        background: var(--mobile-primary-glow);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .mobile-settings-item-icon .material-icons-round {
        font-size: 20px;
        color: var(--mobile-primary);
    }
    
    .mobile-settings-item-content {
        flex: 1;
        min-width: 0;
    }
    
    .mobile-settings-item-label {
        display: block;
        font-size: 15px;
        color: var(--mobile-text-primary);
    }
    
    .mobile-settings-item-desc {
        display: block;
        font-size: 12px;
        color: var(--mobile-text-muted);
        margin-top: 2px;
    }
    
    .mobile-settings-item-value {
        font-size: 14px;
        color: var(--mobile-text-secondary);
    }
    
    .mobile-settings-item-arrow {
        color: var(--mobile-text-muted);
        font-size: 20px;
    }
    
    .mobile-settings-status {
        font-size: 12px;
        padding: 4px 10px;
        border-radius: var(--mobile-radius-full);
        font-weight: 500;
    }
    
    .mobile-settings-status.configured {
        background: rgba(34, 197, 94, 0.2);
        color: #22c55e;
    }
    
    .mobile-settings-status.not-configured {
        background: rgba(239, 68, 68, 0.2);
        color: #ef4444;
    }
    
    .mobile-settings-info {
        background: var(--mobile-bg-surface);
        border-radius: var(--mobile-radius-md);
        padding: 4px 0;
    }
    
    .mobile-settings-info-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 16px;
        font-size: 14px;
    }
    
    .mobile-settings-info-row span:first-child {
        color: var(--mobile-text-secondary);
    }
    
    .mobile-settings-info-row span:last-child {
        color: var(--mobile-text-muted);
    }
</style>
{% endblock %}

{% block scripts %}
<script>
(function() {
    'use strict';
    
    function loadSettings() {
        fetch('/api/settings/', { credentials: 'same-origin' })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                if (!data.success) return;
                
                var config = data.config || {};
                var apiKeys = data.api_keys || {};
                
                // Provider
                var provider = config.default_provider || 'auto';
                document.getElementById('settings-provider').textContent = provider.charAt(0).toUpperCase() + provider.slice(1);
                
                // Cursor mode
                var cursorMode = config.cursor_chat_mode || 'ask';
                document.getElementById('settings-cursor-mode').textContent = cursorMode === 'agent' ? 'Agent' : 'Ask';
                
                // API keys status
                var geminiStatus = document.getElementById('settings-gemini-status');
                var grokStatus = document.getElementById('settings-grok-status');
                
                if (apiKeys.gemini_set) {
                    geminiStatus.textContent = 'Настроен';
                    geminiStatus.className = 'mobile-settings-status configured';
                } else {
                    geminiStatus.textContent = 'Не настроен';
                    geminiStatus.className = 'mobile-settings-status not-configured';
                }
                
                if (apiKeys.grok_set) {
                    grokStatus.textContent = 'Настроен';
                    grokStatus.className = 'mobile-settings-status configured';
                } else {
                    grokStatus.textContent = 'Не настроен';
                    grokStatus.className = 'mobile-settings-status not-configured';
                }
            })
            .catch(function(err) {
                console.error('Error loading settings:', err);
            });
    }
    
    document.addEventListener('DOMContentLoaded', loadSettings);
})();
</script>
{% endblock %}
