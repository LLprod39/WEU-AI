# Проверка места на диске — prod (172.25.173.251)

## Эндпоинт

- **GET /api/disk/** — отчёт по месту на диске (core_ui).
- Источник данных: `get_disk_usage_report` из `app.utils.disk_usage` с путями: **root**, **BASE_DIR**, **MEDIA_ROOT**, **agent_projects**.

---

## Как проверить место на диске на сервере

### 1. Локально (прямо на сервере)

Зайдите на prod по SSH и выполните:

```bash
# Место на диске (все разделы)
df -h

# Проверка API для локального хоста (подставьте порт приложения: 8000, 8080 или 80)
curl -s http://127.0.0.1:8000/api/disk/
```

Успешный ответ API — JSON с полями использования по root, BASE_DIR, MEDIA_ROOT, agent_projects.

### 2. Удалённо (с рабочей машины)

**Вариант A — скрипт (требуется sshpass):**

1. Установить sshpass один раз:  
   `sudo apt install sshpass`
2. Запустить скрипт из каталога с `check_disk_prod.sh`:  
   `./check_disk_prod.sh`  
   Скрипт выведет: `df -h`, ответы GET /api/disk/ по портам 8000/8080/80, процессы и службы приложения.

**Вариант B — одна команда по SSH (требуется sshpass):**

```bash
sshpass -p '<пароль>' ssh -o StrictHostKeyChecking=no lunix@172.25.173.251 -p 22 'df -h'
```

Для проверки API с рабочей машины:

```bash
sshpass -p '<пароль>' ssh -o StrictHostKeyChecking=no lunix@172.25.173.251 -p 22 'curl -s http://127.0.0.1:8000/api/disk/'
```

**Вариант C — MCP (server_execute):**

Если в Cursor подключён MCP с сервером «prod server», выполнить на нём:

- `df -h` — место на диске
- `curl -s http://127.0.0.1:8000/api/disk/` — ответ эндпоинта (порт 8000 замените при необходимости)

---

## Как проверить с рабочей машины (кратко)

1. Установить sshpass (один раз), если ещё не установлен:  
   `sudo apt install sshpass`  
   (Без sshpass скрипт не запустится; тогда используйте «Как проверить прямо на сервере» по SSH.)
2. Из каталога с `check_disk_prod.sh` запустить:  
   `./check_disk_prod.sh`  
   Скрипт выведет: `df -h`, ответы GET /api/disk/ по портам 8000/8080/80, процессы и службы приложения.

## Как проверить прямо на сервере (кратко)

По SSH на prod выполнить:

```bash
# Место на диске
df -h

# Проверка API (подставьте порт, на котором слушает приложение)
curl -s http://127.0.0.1:8000/api/disk/
```

Успешный ответ — JSON с полями использования по root, BASE_DIR, MEDIA_ROOT, agent_projects.

## Вызов из UI

- Если в настройках/админке есть раздел «Диск» или «Система» — оттуда должен вызываться GET /api/disk/ (или тот же отчёт через backend).
- При отсутствии — достаточно проверки по скрипту или curl по инструкции выше.

## Итог

Проверка места на диске на текущем сервере обеспечивается эндпоинтом **GET /api/disk/** и отчётом `get_disk_usage_report` (root, BASE_DIR, MEDIA_ROOT, agent_projects). Для оператора достаточно скрипта `check_disk_prod.sh`, curl на сервере или server_execute (MCP).
