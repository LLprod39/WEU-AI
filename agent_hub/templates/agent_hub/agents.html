{% extends 'base.html' %}
{% load static %}

{% block body_extra_class %}page-agent-hub{% endblock %}
{% block title %}Agents - WEU AI{% endblock %}
{% block header_title %}Agents{% endblock %}
{% block breadcrumbs %}
<nav aria-label="Breadcrumb" class="flex items-center gap-2 text-sm min-w-0">
    <ol class="flex items-center gap-2 list-none flex-wrap" itemscope itemtype="https://schema.org/BreadcrumbList">
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" class="flex items-center gap-2">
            <a href="{% url 'index' %}" class="text-gray-500 hover:text-white transition-colors" itemprop="item"><span itemprop="name">Home</span></a>
            <meta itemprop="position" content="1">
            <span class="text-gray-600" aria-hidden="true">/</span>
        </li>
        <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem" class="flex items-center gap-2" aria-current="page">
            <span class="font-medium text-white" itemprop="name">Agents</span>
            <meta itemprop="position" content="2">
        </li>
    </ol>
</nav>
{% endblock %}

{% block extra_head %}
<style>
.agent-hub {
    --hub-bg: var(--bg-base);
    --hub-card: var(--bg-surface);
    --hub-card-2: var(--bg-elevated);
    --hub-border: var(--border-subtle);
    --hub-text: var(--text-primary);
    --hub-muted: var(--text-secondary);
    --hub-accent: var(--primary);
    --hub-accent-2: var(--accent);
    --hub-danger: var(--error);
    --hub-shadow: var(--shadow-md);
    --hub-modal-surface: #111116;
    --hub-modal-surface-2: #18181f;
    --hub-modal-border: rgba(255, 255, 255, 0.08);
    --hub-modal-glow: var(--primary-glow);
    color: var(--hub-text);
    font-family: var(--font-sans);
    min-height: 100%;
    padding: var(--spacing-xl);
}

.hub-shell {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.hub-hero {
    display: grid;
    gap: var(--spacing-lg);
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    align-items: center;
    background: var(--hub-card);
    border: 1px solid var(--hub-border);
    border-radius: var(--radius-xl);
    padding: var(--spacing-xl);
    box-shadow: var(--hub-shadow);
}

.hub-hero__badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(99, 102, 241, 0.15);
    color: var(--hub-accent);
    padding: 4px 12px;
    border-radius: var(--radius-full);
    font-size: 11px;
    font-weight: var(--font-weight-semibold);
    letter-spacing: 0.06em;
    text-transform: uppercase;
}

.hub-hero h1 {
    font-size: 24px;
    margin: 12px 0 8px;
    font-weight: var(--font-weight-semibold);
}

.hub-hero p {
    color: var(--hub-muted);
    font-size: var(--text-sm);
    line-height: var(--line-height-relaxed);
}

.hub-hero__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 14px;
}

.hub-hero__stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 12px;
}

.hub-stat {
    background: var(--hub-card-2);
    border: 1px solid var(--hub-border);
    border-radius: var(--radius-lg);
    padding: 14px;
}

.hub-stat__label {
    font-size: 11px;
    color: var(--hub-muted);
}

.hub-stat__value {
    font-size: 20px;
    font-weight: var(--font-weight-semibold);
    margin-top: 6px;
}

.hub-tabs {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    background: var(--hub-card);
    padding: 6px;
    border-radius: var(--radius-lg);
    border: 1px solid var(--hub-border);
}

.hub-tab {
    flex: 1;
    padding: 10px 16px;
    border-radius: var(--radius-md);
    background: transparent;
    color: var(--hub-muted);
    font-size: 12px;
    font-weight: var(--font-weight-semibold);
    border: 1px solid transparent;
    cursor: pointer;
    transition: all var(--transition-base);
}

.hub-tab.active {
    background: rgba(99, 102, 241, 0.15);
    color: var(--hub-text);
    border-color: rgba(99, 102, 241, 0.3);
}

.hub-panel {
    display: none;
}

.hub-panel.active {
    display: block;
}

.hub-grid {
    display: grid;
    gap: var(--spacing-lg);
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
}

.hub-grid--workflows {
    grid-template-columns: minmax(280px, 1fr) minmax(360px, 1.4fr);
}

.hub-stack {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.hub-card {
    background: var(--hub-card);
    border: 1px solid var(--hub-border);
    border-radius: var(--radius-lg);
    padding: 18px;
    box-shadow: var(--hub-shadow);
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.hub-card__head {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
}

.hub-card__head h2,
.hub-card__head h3 {
    margin: 0;
    font-size: 15px;
    font-weight: var(--font-weight-semibold);
}

.hub-card__head p {
    margin: 4px 0 0;
    font-size: 12px;
    color: var(--hub-muted);
}

.hub-card__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.hub-card__body {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.hub-form {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.hub-btn {
    padding: 8px 12px;
    border-radius: var(--radius-md);
    border: 1px solid var(--hub-border);
    background: rgba(255, 255, 255, 0.04);
    font-size: 12px;
    font-weight: var(--font-weight-medium);
    color: var(--hub-text);
    cursor: pointer;
    transition: all var(--transition-base);
}

.hub-btn-primary {
    background: var(--hub-accent);
    border-color: transparent;
    color: #fff;
    box-shadow: 0 8px 16px rgba(99, 102, 241, 0.25);
}

.hub-btn-secondary {
    background: rgba(99, 102, 241, 0.15);
    border-color: rgba(99, 102, 241, 0.25);
    color: var(--hub-accent);
}

.hub-btn-ghost {
    background: transparent;
    color: var(--hub-muted);
}

.hub-btn:hover {
    transform: translateY(-1px);
    border-color: var(--border-default);
}

.hub-input,
.hub-select,
.hub-textarea {
    width: 100%;
    padding: 10px 12px;
    border-radius: var(--radius-md);
    background: var(--bg-elevated);
    border: 1px solid var(--hub-border);
    color: var(--hub-text);
    font-size: 12px;
}

.hub-textarea {
    resize: vertical;
}

.hub-form-row {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
}

.hub-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.hub-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 12px;
    background: var(--hub-card-2);
    border: 1px solid var(--hub-border);
    border-radius: var(--radius-md);
}

.hub-row__title {
    font-size: 13px;
    font-weight: var(--font-weight-semibold);
}

.hub-row__meta {
    font-size: 11px;
    color: var(--hub-muted);
}

.hub-row__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.hub-workflow-card {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    padding: 14px;
    border-radius: var(--radius-md);
    border: 1px solid var(--hub-border);
    background: var(--hub-card-2);
}

.hub-workflow-title {
    font-size: 13px;
    font-weight: var(--font-weight-semibold);
    color: var(--hub-text);
}

.hub-workflow-sub {
    font-size: 11px;
    color: var(--hub-muted);
    margin-top: 4px;
}

.hub-empty {
    text-align: center;
    color: var(--hub-muted);
    font-size: 12px;
    padding: 20px;
}

.hub-help {
    font-size: 11px;
    color: var(--hub-muted);
}

.hub-divider {
    height: 1px;
    background: var(--hub-border);
    margin: 12px 0;
}

.hub-run {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 12px;
    border-radius: var(--radius-md);
    border: 1px solid var(--hub-border);
    background: var(--hub-card-2);
}

.hub-run__left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.hub-run__status {
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: var(--hub-muted);
}

.hub-run__status.running { background: var(--hub-accent); }
.hub-run__status.failed { background: var(--hub-danger); }
.hub-run__status.succeeded { background: var(--success); }
.hub-run__status.paused { background: var(--warning); }

.hub-callout {
    background: rgba(99, 102, 241, 0.12);
    border: 1px solid rgba(99, 102, 241, 0.25);
    border-radius: var(--radius-md);
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.hub-callout__title {
    font-weight: var(--font-weight-semibold);
}

.hub-callout__text {
    font-size: 12px;
    color: var(--hub-muted);
}

.hub-links {
    display: grid;
    gap: 8px;
}

.hub-link {
    color: var(--hub-accent);
    font-size: 12px;
}

.hub-banner__card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    background: var(--hub-card);
    border: 1px solid rgba(99, 102, 241, 0.3);
    border-radius: var(--radius-md);
    padding: 12px 16px;
}

.hub-banner__left {
    display: flex;
    align-items: center;
    gap: 10px;
}

.hub-banner__title {
    font-weight: var(--font-weight-semibold);
}

.hub-banner__meta {
    color: var(--hub-muted);
    font-size: 11px;
}

.hub-dot {
    width: 10px;
    height: 10px;
    background: var(--hub-accent);
    border-radius: 999px;
    box-shadow: 0 0 12px rgba(99, 102, 241, 0.6);
}

/* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞ .hub-modal: –º–æ–¥–∞–ª–∫–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –≤–Ω–µ .agent-hub, –∏–Ω–∞—á–µ --hub-modal-surface –Ω–µ –∑–∞–¥–∞–Ω–∞ –∏ —Ñ–æ–Ω –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π */
.hub-modal {
    --hub-modal-surface: #111116;
    --hub-modal-surface-2: #18181f;
    --hub-modal-border: rgba(255, 255, 255, 0.08);
    position: fixed;
    inset: 0;
    z-index: 120;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 24px;
}

.hub-modal.hidden {
    display: none;
}

.hub-modal__backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.6);
}

.hub-modal__panel {
    position: relative;
    z-index: 1;
    width: min(980px, 94vw);
    max-height: 90vh;
    overflow: hidden;
    background: var(--hub-modal-surface, #111116) !important;
    background-color: var(--hub-modal-surface, #111116) !important;
    opacity: 1;
    border: 1px solid var(--hub-modal-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    outline: 1px solid rgba(255, 255, 255, 0.04);
    display: flex;
    flex-direction: column;
}

.hub-modal__head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
    padding: 20px 24px;
    border-bottom: 1px solid var(--hub-modal-border);
    background: var(--hub-modal-surface, #111116) !important;
    background-color: var(--hub-modal-surface, #111116) !important;
}

.hub-modal__title {
    margin: 0;
    font-size: 18px;
    font-weight: var(--font-weight-semibold);
}

.hub-modal__body {
    flex: 1;
    min-height: 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
    padding: 20px 24px 24px;
    overflow-y: auto;
    background: var(--hub-modal-surface, #111116) !important;
    background-color: var(--hub-modal-surface, #111116) !important;
}

.hub-modal:not(.hidden) .hub-modal__panel {
    animation: modal-rise 0.26s ease;
}

.hub-modal:not(.hidden) .hub-modal__backdrop {
    animation: modal-fade 0.2s ease;
}

@keyframes modal-rise {
    from { opacity: 0; transform: translateY(14px) scale(0.98); }
    to { opacity: 1; transform: translateY(0) scale(1); }
}

@keyframes modal-fade {
    from { opacity: 0; }
    to { opacity: 1; }
}

@media (prefers-reduced-motion: reduce) {
    .hub-modal:not(.hidden) .hub-modal__panel,
    .hub-modal:not(.hidden) .hub-modal__backdrop {
        animation: none;
    }
}

.hub-tools {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 8px;
}

.hub-tool {
    display: flex;
    align-items: center;
    gap: 6px;
    background: var(--hub-card-2);
    border: 1px solid var(--hub-border);
    border-radius: var(--radius-md);
    padding: 6px 8px;
    font-size: 12px;
}

.hub-checkbox {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--hub-muted);
}

.hub-label {
    font-size: 11px;
    color: var(--hub-muted);
}

.hub-field {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.hub-toggle {
    position: relative;
    display: inline-flex;
    align-items: center;
    gap: 10px;
    font-size: 12px;
    color: var(--hub-text);
    cursor: pointer;
}

.hub-toggle input {
    position: absolute;
    opacity: 0;
    width: 1px;
    height: 1px;
}

.hub-toggle__control {
    width: 40px;
    height: 22px;
    border-radius: 999px;
    background: var(--bg-base);
    border: 1px solid var(--border-default);
    position: relative;
    transition: all var(--transition-base);
    flex-shrink: 0;
}

.hub-toggle__control::after {
    content: "";
    position: absolute;
    top: 2px;
    left: 2px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    background: #fff;
    transition: transform var(--transition-base);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
}

.hub-toggle input:checked + .hub-toggle__control {
    background: rgba(99, 102, 241, 0.6);
    border-color: rgba(99, 102, 241, 0.6);
}

.hub-toggle input:checked + .hub-toggle__control::after {
    transform: translateX(18px);
}

.hub-toggle input:focus-visible + .hub-toggle__control {
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
}

.hub-toggle__text {
    font-size: 12px;
    color: var(--hub-text);
}

.hub-modal .hub-input,
.hub-modal .hub-select,
.hub-modal .hub-textarea {
    background: var(--hub-modal-surface-2) !important;
    background-color: var(--hub-modal-surface-2) !important;
    border-color: var(--border-default);
    font-size: 14px;
    padding: 11px 12px;
    transition: border-color var(--transition-base), box-shadow var(--transition-base), background var(--transition-base);
}

.hub-modal .hub-input:focus,
.hub-modal .hub-select:focus,
.hub-modal .hub-textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
    background: var(--hub-modal-surface-2);
}

.hub-modal .hub-label {
    font-size: 12px;
    color: var(--text-secondary);
}

.hub-modal .hub-help {
    font-size: 12px;
    color: var(--text-secondary);
}

.hub-modal .hub-btn {
    padding: 8px 14px;
}

.hub-btn--icon {
    border-radius: 999px;
    font-size: 11px;
    padding: 6px 12px;
}

.tb-modal .hub-modal__panel {
    width: min(1280px, 96vw);
    max-height: 94vh;
    overflow: hidden;
}

.tb-panel {
    display: flex;
    flex-direction: column;
    min-height: 0;
    padding: 0;
}

.tb-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 12px;
    padding: 18px 22px;
    border-bottom: 1px solid var(--hub-modal-border);
    background: var(--hub-modal-surface) !important;
    background-color: var(--hub-modal-surface) !important;
    position: sticky;
    top: 0;
    z-index: 2;
}

.tb-header__actions {
    display: flex;
    align-items: center;
    gap: 8px;
}

.tb-title {
    font-size: 18px;
    font-weight: var(--font-weight-semibold);
}

.tb-sub {
    font-size: 12px;
    color: var(--hub-muted);
    margin-top: 4px;
}

.tb-body {
    flex: 1;
    display: grid;
    grid-template-columns: minmax(280px, 330px) 1fr;
    gap: 18px;
    padding: 18px 22px 20px;
    min-height: 0;
}

.tb-sidebar {
    display: flex;
    flex-direction: column;
    gap: 16px;
    overflow-y: auto;
    padding-right: 4px;
}

.tb-section {
    background: var(--hub-modal-surface-2) !important;
    background-color: var(--hub-modal-surface-2) !important;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.tb-ai {
    border-color: rgba(99, 102, 241, 0.25);
    background: rgba(99, 102, 241, 0.1);
}

.tb-section__title {
    font-size: 12px;
    font-weight: var(--font-weight-semibold);
    color: var(--hub-text);
}

.tb-stats-row {
    display: flex;
    justify-content: space-between;
    font-size: 12px;
    color: var(--hub-muted);
}

.tb-stats-row span:last-child {
    font-variant-numeric: tabular-nums;
    color: var(--hub-text);
    font-weight: var(--font-weight-semibold);
}

.tb-tasks {
    display: flex;
    flex-direction: column;
    min-height: 0;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    background: var(--hub-modal-surface-2) !important;
    background-color: var(--hub-modal-surface-2) !important;
    overflow: hidden;
}

.tb-tasks-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 12px 14px;
    border-bottom: 1px solid var(--border-default);
    background: var(--bg-surface) !important;
    background-color: var(--bg-surface) !important;
}

.tb-tasks-list {
    flex: 1;
    overflow-y: auto;
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.tb-empty {
    min-height: 220px;
    border: 1px dashed var(--border-default);
    border-radius: var(--radius-md);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: var(--hub-muted);
    padding: 20px;
    gap: 10px;
}

.tb-empty__title {
    font-weight: var(--font-weight-semibold);
    color: var(--hub-text);
}

.tb-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 12px 20px;
    border-top: 1px solid var(--hub-border);
    background: var(--hub-card);
}

.tb-footer__actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.task-card {
    background: var(--hub-card-2);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    padding: 12px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.task-card__head {
    display: flex;
    align-items: center;
    gap: 10px;
}

.task-card__meta {
    flex: 1;
    min-width: 0;
}

.task-card__subtitle {
    font-size: 11px;
    color: var(--hub-muted);
    margin-top: 4px;
}

.task-number {
    width: 28px;
    height: 28px;
    border-radius: var(--radius-sm);
    background: rgba(99, 102, 241, 0.2);
    color: var(--hub-accent);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: var(--font-weight-semibold);
}

.task-title {
    width: 100%;
    background: transparent;
    border: none;
    border-bottom: 1px solid var(--hub-border);
    color: var(--hub-text);
    font-size: 13px;
    font-weight: var(--font-weight-semibold);
    padding-bottom: 6px;
}

.task-title:focus {
    outline: none;
    border-bottom-color: var(--hub-accent);
}

.task-prompt,
.task-verify,
.task-model,
.task-promise,
.task-verify-promise {
    width: 100%;
    background: var(--bg-base);
    border: 1px solid var(--border-default);
    border-radius: var(--radius-sm);
    color: var(--hub-text);
    font-size: 13px;
    padding: 8px 10px;
}

.task-prompt,
.task-verify {
    resize: vertical;
}

.task-model-row {
    display: flex;
    align-items: center;
    gap: 10px;
}

.task-inline-label {
    font-size: 12px;
    color: var(--hub-muted);
    min-width: 70px;
}

.toggle-test-btn {
    background: transparent;
    border: none;
    color: var(--hub-muted);
    font-size: 12px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.toggle-test-btn:hover {
    color: var(--hub-accent);
}

.test-content {
    margin-top: 10px;
    background: var(--bg-surface);
    border: 1px solid rgba(99, 102, 241, 0.25);
    border-radius: var(--radius-sm);
    padding: 10px;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.task-test-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 10px;
}

.delete-task-btn {
    background: transparent;
    border: none;
    color: var(--hub-muted);
    cursor: pointer;
}

.delete-task-btn:hover {
    color: var(--hub-danger);
}

.drag-handle {
    color: var(--hub-muted);
    cursor: grab;
    padding-top: 2px;
}

.drag-handle:active {
    cursor: grabbing;
}

.agent-editor-panel {
    width: min(1100px, 94vw);
}

.agent-editor-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 20px;
}

.agent-editor-section,
.agent-run-section {
    background: var(--hub-modal-surface-2) !important;
    background-color: var(--hub-modal-surface-2) !important;
    opacity: 1;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.agent-editor-section h3,
.agent-run-section h3 {
    margin: 0;
    font-size: 13px;
    font-weight: var(--font-weight-semibold);
    letter-spacing: 0;
    text-transform: none;
    color: var(--hub-text);
}

.agent-editor-section--full {
    grid-column: 1 / -1;
}

.agent-editor-actions {
    grid-column: 1 / -1;
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding-top: 20px;
    margin-top: 8px;
    border-top: 1px solid var(--hub-modal-border);
}

.server-group-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.server-group-chip {
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid var(--border-default);
    background: var(--bg-elevated);
    font-size: 11px;
    color: var(--hub-muted);
    cursor: pointer;
    transition: all var(--transition-base);
}

.server-group-chip.active {
    border-color: rgba(99, 102, 241, 0.4);
    color: var(--hub-text);
    background: rgba(99, 102, 241, 0.15);
}

.server-picker {
    display: flex;
    flex-direction: column;
    gap: 6px;
    max-height: 260px;
    overflow-y: auto;
    padding: 6px;
    border: 1px solid var(--border-default);
    border-radius: var(--radius-md);
    background: var(--bg-elevated);
}

.server-picker.disabled {
    opacity: 0.5;
    pointer-events: none;
}

.server-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 8px;
    border-radius: var(--radius-sm);
    background: var(--bg-surface);
    border: 1px solid transparent;
}

.server-item:hover {
    border-color: var(--hub-border);
}

.server-check {
    width: 16px;
    height: 16px;
    border-radius: 4px;
    border: 1px solid var(--hub-border);
    background: var(--bg-elevated);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}

.server-check input {
    appearance: none;
    width: 16px;
    height: 16px;
    margin: 0;
    cursor: pointer;
}

.server-check input:checked {
    background: var(--hub-accent);
    border-radius: 4px;
    border: 1px solid var(--hub-accent);
    box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}

.server-check input:checked::after {
    content: "";
    width: 6px;
    height: 10px;
    border: solid #fff;
    border-width: 0 2px 2px 0;
    display: block;
    margin: 1px auto 0;
    transform: rotate(45deg);
}

.server-meta {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.server-name {
    font-size: 12px;
    font-weight: var(--font-weight-semibold);
}

.server-host {
    font-size: 11px;
    color: var(--hub-muted);
}

.server-group-label {
    font-size: 10px;
    color: var(--hub-muted);
}

.agent-run-panel {
    width: min(920px, 94vw);
}

.agent-run-grid {
    display: grid;
    grid-template-columns: 1.2fr 1fr;
    gap: 20px;
}

.agent-run-title {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 12px;
    border-radius: 999px;
    background: rgba(99, 102, 241, 0.18);
    color: var(--hub-text);
    font-size: 12px;
    font-weight: var(--font-weight-semibold);
}

.agent-run-subtitle {
    font-size: 12px;
    font-weight: var(--font-weight-semibold);
    color: var(--hub-text);
}

.agent-editor-panel .hub-modal__head,
.agent-run-panel .hub-modal__head {
    border-bottom-color: rgba(148, 163, 184, 0.2);
}

.agent-editor-panel .hub-modal__body,
.agent-run-panel .hub-modal__body {
    padding-top: 20px;
}

.agent-editor-panel .hub-input,
.agent-editor-panel .hub-select,
.agent-editor-panel .hub-textarea,
.agent-run-panel .hub-input,
.agent-run-panel .hub-select,
.agent-run-panel .hub-textarea {
    font-size: 13px;
}

.agent-editor-panel .hub-textarea,
.agent-run-panel .hub-textarea {
    line-height: 1.5;
}

.agent-run-actions {
    grid-column: 1 / -1;
    display: flex;
    justify-content: flex-end;
    gap: 8px;
    padding-top: 20px;
    margin-top: 8px;
    border-top: 1px solid var(--hub-modal-border);
}

@media (max-width: 960px) {
    .hub-modal {
        padding: 18px;
    }
    .hub-modal__head {
        padding: 16px 18px;
    }
    .hub-modal__body {
        padding: 16px 18px 20px;
    }
    .hub-grid--workflows {
        grid-template-columns: 1fr;
    }
    .tb-body {
        grid-template-columns: 1fr;
    }
    .agent-editor-grid {
        grid-template-columns: 1fr;
    }
    .agent-run-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 720px) {
    .agent-hub {
        padding: 16px;
    }
    .hub-hero {
        padding: 20px;
    }
    .hub-card {
        padding: 16px;
    }
    .hub-modal {
        padding: 12px;
    }
    .hub-modal__panel {
        border-radius: 16px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="agent-hub">
    <div class="hub-shell">
        <div id="active-runs-banner" class="hub-banner hidden">
            <div class="hub-banner__card">
                <div class="hub-banner__left">
                    <span class="hub-dot"></span>
                    <div>
                        <div class="hub-banner__title">–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–¥–∞—á–∞</div>
                        <div id="active-runs-info" class="hub-banner__meta"></div>
                    </div>
                </div>
                <button onclick="scrollToActiveRuns()" class="hub-btn hub-btn-ghost">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ª–æ–≥–∞–º</button>
            </div>
        </div>

        <section class="hub-hero">
            <div class="hub-hero__copy">
                <div class="hub-hero__badge">Agent Hub</div>
                <h1>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞–º–∏, workflow –∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π</h1>
                <p>–ï–¥–∏–Ω—ã–π —Ü–µ–Ω—Ç—Ä: –∞–≥–µ–Ω—Ç–Ω—ã–µ —Ä–æ–ª–∏, —Å—Ü–µ–Ω–∞—Ä–∏–∏, –≤–µ–±—Ö—É–∫–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –ë—ã—Å—Ç—Ä–æ, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ, –±–µ–∑ —à—É–º–∞.</p>
                <div class="hub-hero__actions">
                    <button class="hub-btn hub-btn-primary" onclick="openAgentEditor()">–°–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞</button>
                    <button class="hub-btn hub-btn-secondary" onclick="openTaskBuilderDirect()">–ù–æ–≤—ã–π workflow</button>
                    <button class="hub-btn hub-btn-ghost" onclick="openWebhookForm()">–ù–æ–≤—ã–π webhook</button>
                </div>
            </div>
            <div class="hub-hero__stats">
                <div class="hub-stat">
                    <div class="hub-stat__label">Agents</div>
                    <div class="hub-stat__value" id="stat-agents">0</div>
                </div>
                <div class="hub-stat">
                    <div class="hub-stat__label">Workflows</div>
                    <div class="hub-stat__value" id="stat-workflows">{{ workflows|length }}</div>
                </div>
                <div class="hub-stat">
                    <div class="hub-stat__label">Webhooks</div>
                    <div class="hub-stat__value" id="stat-webhooks">0</div>
                </div>
                <div class="hub-stat">
                    <div class="hub-stat__label">Runs</div>
                    <div class="hub-stat__value" id="stat-runs">{{ recent_runs|length }}</div>
                </div>
            </div>
        </section>

        <nav class="hub-tabs" role="tablist">
            <button class="hub-tab active" data-hub-tab="agents" role="tab">Agents</button>
            <button class="hub-tab" data-hub-tab="workflows" role="tab">Workflows</button>
            <button class="hub-tab" data-hub-tab="automation" role="tab">Automation</button>
            <button class="hub-tab" data-hub-tab="runs" role="tab">Runs</button>
        </nav>

        <section class="hub-panel active" data-hub-panel="agents">
            <div class="hub-grid">
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>–ê–≥–µ–Ω—Ç—ã</h2>
                            <p>–†–æ–ª–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –Ω–∞–≤—ã–∫–∏. –ü–æ–¥–∫–ª—é—á–∞–π—Ç–µ skills –∏ —Å–µ—Ä–≤–µ—Ä–∞.</p>
                        </div>
                        <div class="hub-card__actions">
                            <input id="agent-search" class="hub-input" placeholder="–ü–æ–∏—Å–∫ –∞–≥–µ–Ω—Ç–∞">
                            <button class="hub-btn hub-btn-primary" onclick="openAgentEditor()">+ Agent</button>
                        </div>
                    </div>
                    <div id="custom-agents-list" class="hub-list"></div>
                </div>
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>–ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞</h2>
                            <p>–í—ã–±–µ—Ä–∏—Ç–µ –∞–≥–µ–Ω—Ç–∞ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–¥–∞—á—É —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏–ª–∏ —Å—Ä–∞–∑—É.</p>
                        </div>
                    </div>
                    <div class="hub-card__body">
                        <div id="selected-agent-preview" class="hub-empty">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≥–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ —Å–ª–µ–≤–∞.</div>
                        <div class="hub-card__actions" style="margin-top: 16px;">
                            <button class="hub-btn hub-btn-secondary" onclick="openAgentRun()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                            <button class="hub-btn hub-btn-ghost" onclick="openAgentEditor()">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≥–µ–Ω—Ç–∞</button>
                        </div>
                        <div class="hub-divider"></div>
                        <div class="hub-links">
                            <a href="https://chatgpt.com/codex" target="_blank" rel="noopener noreferrer" class="hub-link" title="Codex Cloud ‚Äî –≤—Ö–æ–¥ —á–µ—Ä–µ–∑ ChatGPT">Codex Cloud: –≤—Ö–æ–¥ –∏ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å</a>
                            <a href="/skills/" class="hub-link">Skills: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞–Ω–∏—è–º–∏</a>
                            <a href="/tasks/settings/" class="hub-link">Automation settings –¥–ª—è –∑–∞–¥–∞—á</a>
                            <a href="/tasks/" class="hub-link">–í—Å–µ –∑–∞–¥–∞—á–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="hub-panel" data-hub-panel="workflows">
            <div class="hub-grid hub-grid--workflows">
                <div class="hub-stack">
                    <div class="hub-card">
                        <div class="hub-card__head">
                            <div>
                                <h2>–ë—ã—Å—Ç—Ä—ã–π workflow</h2>
                                <p>–û–ø–∏—à–∏ —Å—Ü–µ–Ω–∞—Ä–∏–π, –≤—ã–±–µ—Ä–∏ runtime –∏ –ø—Ä–æ–µ–∫—Ç. –ú—ã —Å–æ–±–µ—Ä—ë–º —à–∞–≥–∏.</p>
                            </div>
                        </div>
                        <div class="hub-card__body">
                            <textarea id="quick-task" rows="3" class="hub-textarea" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –∏ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏"></textarea>
                            <div class="hub-form-row">
                                <select id="quick-runtime" class="hub-select">
                                    <option value="cursor" selected>Cursor CLI</option>
                                    <option value="codex">Codex CLI</option>
                                    <option value="ralph">Ralph Orchestrator</option>
                                </select>
                                <select id="quick-project" class="hub-select">
                                    <option value="__new__">üìÅ –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</option>
                                    {% for project in projects_data %}
                                    <option value="{{ project.path }}">üìÇ {{ project.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <input id="quick-project-name" type="text" class="hub-input hidden" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞">
                            <div class="hub-card__actions" style="margin-top: 12px;">
                                <button id="btn-auto-create-all" onclick="autoCreateAll()" class="hub-btn hub-btn-primary">–°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
                                <button type="button" onclick="openTaskBuilderDirect()" class="hub-btn hub-btn-secondary">–û—Ç–∫—Ä—ã—Ç—å Builder</button>
                            </div>
                            <p class="hub-help">–î–æ–±–∞–≤—å —Å—Ç–µ–∫, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ ‚Äî –ø–æ–ª—É—á–∏—à—å —Ç–æ—á–Ω—ã–π workflow.</p>
                        </div>
                    </div>
                    <div class="hub-card">
                        <div class="hub-card__head">
                            <div>
                                <h2>Presets</h2>
                                <p>–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞.</p>
                            </div>
                        </div>
                        <div class="hub-list">
                            {% for preset in presets %}
                            <div class="hub-row">
                                <div>
                                    <div class="hub-row__title">{{ preset.name }}</div>
                                    <div class="hub-row__meta">{{ preset.description|default:"" }}</div>
                                </div>
                                <div class="hub-row__actions">
                                    <button type="button" onclick="usePreset('{{ preset.name|escapejs }}')" class="hub-btn hub-btn-ghost">Use</button>
                                </div>
                            </div>
                            {% empty %}
                            <div class="hub-empty">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö presets.</div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>Workflow Library</h2>
                            <p>–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏, –∏–º–ø–æ—Ä—Ç –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤.</p>
                        </div>
                        <div class="hub-card__actions">
                            <button type="button" onclick="openImportModal()" class="hub-btn hub-btn-ghost">Import</button>
                            <button type="button" onclick="openTaskBuilderDirect()" class="hub-btn hub-btn-secondary">Builder</button>
                        </div>
                    </div>
                    <div class="hub-list">
                        {% for workflow in workflows %}
                        <div class="hub-workflow-card">
                            <div>
                                <div class="hub-workflow-title">{{ workflow.name }}</div>
                                <div class="hub-workflow-sub">
                                    {{ workflow.runtime|title }}
                                    {% if workflow.target_server %} ‚Ä¢ {{ workflow.target_server.name }}{% endif %}
                                    {% if workflow.script.steps %} ‚Ä¢ {{ workflow.script.steps|length }} steps{% endif %}
                                    {% if workflow.project_path %} ‚Ä¢ {{ workflow.project_path }}{% endif %}
                                </div>
                            </div>
                            <div class="hub-row__actions">
                                <button type="button" onclick="editWorkflow({{ workflow.id }})" class="hub-btn hub-btn-ghost">Edit</button>
                                <button type="button" onclick="openWorkflowScript({{ workflow.id }})" class="hub-btn hub-btn-ghost">Script</button>
                                <button type="button" onclick="deleteWorkflow({{ workflow.id }})" class="hub-btn hub-btn-ghost">Delete</button>
                                <button type="button" onclick="runWorkflow({{ workflow.id }}, event)" class="hub-btn hub-btn-secondary">Run</button>
                            </div>
                        </div>
                        {% empty %}
                        <div class="hub-empty">Workflows –ø–æ–∫–∞ –Ω–µ—Ç. –°–æ–∑–¥–∞–π —á–µ—Ä–µ–∑ Builder.</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>

        <section class="hub-panel" data-hub-panel="automation">
            <div class="hub-grid">
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>Webhooks</h2>
                            <p>–¢—Ä–∏–≥–≥–µ—Ä—ã –æ—Ç Zabbix –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–æ–º.</p>
                        </div>
                        <div class="hub-card__actions">
                            <button type="button" onclick="toggleWebhookForm()" class="hub-btn hub-btn-secondary">+ New</button>
                            <button type="button" onclick="loadWebhooks()" class="hub-btn hub-btn-ghost">Refresh</button>
                        </div>
                    </div>
                    <div id="webhook-form" class="hub-form hidden">
                        <div class="hub-form-row">
                            <input id="webhook-name" class="hub-input" placeholder="Webhook name">
                            <select id="webhook-source-preset" class="hub-select">
                                <option value="generic">Generic</option>
                                <option value="zabbix">Zabbix</option>
                                <option value="email">Email</option>
                                <option value="slack">Slack</option>
                                <option value="jira">Jira</option>
                                <option value="github">GitHub</option>
                                <option value="pagerduty">PagerDuty</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <div class="hub-form-row">
                            <input id="webhook-source" class="hub-input" placeholder="source (zabbix/email/slack/etc)">
                            <select id="webhook-custom-agent" class="hub-select">
                                <option value="">‚Äî not set ‚Äî</option>
                            </select>
                        </div>
                        <div class="hub-form-row">
                            <select id="webhook-agent-type" class="hub-select">
                                <option value="react">react</option>
                                <option value="ralph">ralph</option>
                                <option value="complex">complex</option>
                                <option value="simple">simple</option>
                            </select>
                            <select id="webhook-execution-mode" class="hub-select">
                                <option value="task">task</option>
                                <option value="workflow">workflow</option>
                            </select>
                        </div>
                        <div class="hub-form-row">
                            <select id="webhook-workflow-template" class="hub-select">
                                <option value="">LLM generate</option>
                                <option value="remediation">Remediation</option>
                            </select>
                            <select id="webhook-target-server" class="hub-select">
                                <option value="">auto by payload</option>
                            </select>
                        </div>
                        <div class="hub-form-row">
                            <select id="webhook-runtime" class="hub-select">
                                <option value="">runtime auto</option>
                                <option value="cursor">cursor</option>
                                <option value="claude">claude</option>
                                <option value="gemini">gemini</option>
                                <option value="grok">grok</option>
                            </select>
                            <input id="webhook-server-field" class="hub-input" placeholder="server field (optional) e.g. host.name">
                        </div>
                        <div class="hub-form-row">
                            <input id="webhook-event-id-field" class="hub-input" placeholder="external id field (event.id/message_id)">
                            <input id="webhook-event-name-field" class="hub-input" placeholder="event name field (trigger.name/subject)">
                        </div>
                        <div class="hub-form-row">
                            <input id="webhook-event-name" class="hub-input" placeholder="default event name (optional)">
                        </div>
                        <div class="hub-form-row">
                            <input id="webhook-title-template" class="hub-input" placeholder="{{webhook_name}}: {{event_name}}">
                        </div>
                        <div class="hub-form-row">
                            <textarea id="webhook-description-template" class="hub-textarea" rows="3" placeholder="{{payload_json}}"></textarea>
                        </div>
                        <div id="webhook-workflow-extra" class="hidden">
                            <div class="hub-form-row">
                                <textarea id="webhook-verify-prompt" class="hub-textarea" rows="2" placeholder="Verify prompt (optional)"></textarea>
                            </div>
                            <div class="hub-form-row">
                                <select id="webhook-skill-ids" class="hub-select" multiple></select>
                            </div>
                        </div>
                        <div class="hub-help">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ: {{webhook_name}}, {{source}}, {{received_at}}, {{event_name}}, {{payload_json}}, –∞ —Ç–∞–∫–∂–µ –ª—é–±—ã–µ –ø–æ–ª—è payload —á–µ—Ä–µ–∑ {{field.path}}.</div>
                        <label class="hub-checkbox">
                            <input type="checkbox" id="webhook-auto-execute" checked>
                            Auto execute
                        </label>
                        <div class="hub-card__actions">
                            <button type="button" onclick="saveWebhook()" class="hub-btn hub-btn-primary">Save</button>
                            <button type="button" onclick="cancelWebhookForm()" class="hub-btn hub-btn-ghost">Cancel</button>
                        </div>
                    </div>
                    <div id="webhooks-list" class="hub-list"></div>
                </div>
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>Automation controls</h2>
                            <p>–ö–æ–Ω—Ç—Ä–æ–ª—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏ MCP-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.</p>
                        </div>
                    </div>
                    <div class="hub-card__body">
                        <div class="hub-callout">
                            <div class="hub-callout__title">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–¥–∞—á</div>
                            <div class="hub-callout__text">–ù–∞—Å—Ç—Ä–æ–π, –∫–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è approval, –∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞–≤—Ç–æ-–∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è.</div>
                            <a href="/tasks/settings/" class="hub-btn hub-btn-ghost">–û—Ç–∫—Ä—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</a>
                        </div>
                        <div class="hub-divider"></div>
                        <div class="hub-card__head" style="padding: 0;">
                            <h3>MCP Servers</h3>
                            <button onclick="refreshMcpServers()" class="hub-btn hub-btn-ghost">Refresh</button>
                        </div>
                        <div id="mcp-servers-list" class="hub-list"></div>
                        <div id="mcp-sources" class="hub-help"></div>
                    </div>
                </div>
            </div>
        </section>

        <section class="hub-panel" data-hub-panel="runs">
            <div class="hub-grid">
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>Workflow runs</h2>
                            <p>–¢–µ–∫—É—â–∏–µ –∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–≥–æ–Ω—ã.</p>
                        </div>
                    </div>
                    <div id="workflow-runs-list" class="hub-list">
                        {% for item in workflow_runs %}
                        <div class="hub-run workflow-run-card" data-run-id="{{ item.run.id }}" data-status="{{ item.run.status }}">
                            <div class="hub-run__left">
                                <div class="hub-run__status {{ item.run.status }}"></div>
                                <div>
                                    <div class="hub-row__title">{{ item.run.workflow.name }}</div>
                                    <div class="hub-row__meta">{{ item.run.status|title }} ‚Ä¢ {{ item.progress_pct }}% ‚Ä¢ Step {{ item.run.current_step }}/{{ item.total_steps|default:0 }}</div>
                                </div>
                            </div>
                            <div class="hub-row__actions">
                                <a href="/agents/logs/?type=workflow&run_id={{ item.run.id }}" class="hub-btn hub-btn-ghost">Logs</a>
                                {% if item.run.status == 'running' %}
                                <button onclick="stopWorkflow({{ item.run.id }})" class="hub-btn hub-btn-ghost">Stop</button>
                                {% else %}
                                <button onclick="restartWorkflow({{ item.run.id }})" class="hub-btn hub-btn-ghost">Restart</button>
                                <button onclick="deleteWorkflowRun({{ item.run.id }})" class="hub-btn hub-btn-ghost">Delete</button>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="hub-empty">–ó–∞–ø—É—Å–∫–æ–≤ workflow –ø–æ–∫–∞ –Ω–µ—Ç.</div>
                        {% endfor %}
                    </div>
                </div>
                <div class="hub-card">
                    <div class="hub-card__head">
                        <div>
                            <h2>Agent runs</h2>
                            <p>–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø—É—Å–∫–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤.</p>
                        </div>
                    </div>
                    <div class="hub-list">
                        {% for run in recent_runs %}
                        <div class="hub-row">
                            <div>
                                <div class="hub-row__title">{{ run.input_task|truncatewords:10 }}</div>
                                <div class="hub-row__meta">{{ run.runtime|title }} ‚Ä¢ {{ run.status|title }}</div>
                            </div>
                            <div class="hub-row__actions">
                                <a href="/agents/logs/?type=run&run_id={{ run.id }}" class="hub-btn hub-btn-ghost">Logs</a>
                                {% if run.status == 'running' %}
                                <button onclick="stopAgentRun({{ run.id }})" class="hub-btn hub-btn-ghost">Stop</button>
                                {% endif %}
                            </div>
                        </div>
                        {% empty %}
                        <div class="hub-empty">–ó–∞–ø—É—Å–∫–æ–≤ –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
    </div>
</div>

<div id="agentEditorModal" class="hub-modal hidden" role="dialog" aria-modal="true" aria-labelledby="agent-editor-title">
    <div class="hub-modal__backdrop" onclick="closeAgentEditor()"></div>
    <div class="hub-modal__panel agent-editor-panel">
        <div class="hub-modal__head">
            <h2 id="agent-editor-title" class="hub-modal__title">–ù–æ–≤—ã–π –∞–≥–µ–Ω—Ç</h2>
            <button class="hub-btn hub-btn-ghost hub-btn--icon" onclick="closeAgentEditor()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <form id="agent-editor-form" class="hub-modal__body agent-editor-grid">
            <input type="hidden" id="agent-editor-id">

            <div class="agent-editor-section agent-editor-section--full hub-assist-block">
                <h3>‚ú® –°–æ–∑–¥–∞—Ç—å —Å –ø–æ–º–æ—â—å—é AI</h3>
                <p class="hub-help">–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É ‚Äî AI –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –∏–º—è, –æ–ø–∏—Å–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≥–µ–Ω—Ç–∞.</p>
                <textarea id="agent-assist-task" class="hub-textarea" rows="2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∞–≥–µ–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∏—Å–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö, —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—á—ë—Ç–∞ –∏ –∞–ª–µ—Ä—Ç –≤ Zabbix"></textarea>
                <div class="hub-card__actions" style="margin-top: 8px;">
                    <button type="button" id="btn-agent-assist" onclick="applyAssistConfig()" class="hub-btn hub-btn-secondary">–ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </div>
            </div>

            <div class="agent-editor-section">
                <h3>–ò–¥–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å</h3>
                <label class="hub-label" for="agent-editor-name">–ò–º—è –∞–≥–µ–Ω—Ç–∞</label>
                <input id="agent-editor-name" class="hub-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: DevOps Navigator">
                <label class="hub-label" for="agent-editor-description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                <input id="agent-editor-description" class="hub-input" placeholder="–ö–æ—Ä–æ—Ç–∫–æ: –∑–∞—á–µ–º –æ–Ω –Ω—É–∂–µ–Ω">
            </div>

            <div class="agent-editor-section">
                <h3>–ö–æ–Ω—Ç–µ–∫—Å—Ç</h3>
                <label class="hub-label" for="agent-editor-knowledge-base">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</label>
                <textarea id="agent-editor-knowledge-base" class="hub-textarea" rows="4" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å—Ç–µ–∫, —Å—Å—ã–ª–∫–∏, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞"></textarea>
            </div>

            <div class="agent-editor-section agent-editor-section--full">
                <h3>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</h3>
                <label class="hub-label" for="agent-editor-system-prompt">–°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç</label>
                <textarea id="agent-editor-system-prompt" class="hub-textarea" rows="4" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –≤—Å–µ–≥–¥–∞ —É—Ç–æ—á–Ω—è–π –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç–∏, –ø–∏—à–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ"></textarea>
                <label class="hub-label" for="agent-editor-instructions">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏</label>
                <textarea id="agent-editor-instructions" class="hub-textarea" rows="3" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ: —Ñ–æ—Ä–º–∞—Ç, —Å—Ç–∏–ª—å, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è"></textarea>
            </div>

            <div class="agent-editor-section">
                <h3>–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
                <div class="hub-form-row">
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-runtime">Runtime</label>
                        <select id="agent-editor-runtime" class="hub-select">
                            <option value="claude">claude</option>
                            <option value="cursor">cursor</option>
                            <option value="internal">internal</option>
                        </select>
                    </div>
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-model">–ú–æ–¥–µ–ª—å</label>
                        <select id="agent-editor-model" class="hub-select">
                            <option value="claude-4.5-sonnet">claude-4.5-sonnet</option>
                            <option value="claude-4.5-opus">claude-4.5-opus</option>
                            <option value="claude-4.5-haiku">claude-4.5-haiku</option>
                            <option value="grok-3">grok-3</option>
                            <option value="auto">auto</option>
                        </select>
                    </div>
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-orchestrator">–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä</label>
                        <select id="agent-editor-orchestrator" class="hub-select">
                            <option value="ralph_internal">ralph_internal</option>
                            <option value="react">react</option>
                        </select>
                    </div>
                </div>
                <div class="hub-form-row">
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-max-iterations">–ú–∞–∫—Å. –∏—Ç–µ—Ä–∞—Ü–∏–π</label>
                        <input id="agent-editor-max-iterations" class="hub-input" type="number" min="1" value="10" placeholder="10">
                    </div>
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-temperature">Temperature</label>
                        <input id="agent-editor-temperature" class="hub-input" type="number" min="0" max="1" step="0.1" value="0.7" placeholder="0.7">
                    </div>
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-completion-promise">Completion</label>
                        <input id="agent-editor-completion-promise" class="hub-input" value="COMPLETE" placeholder="COMPLETE">
                    </div>
                </div>
            </div>

            <div class="agent-editor-section">
                <h3>–î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º</h3>
                <label class="hub-toggle">
                    <input type="checkbox" id="agent-editor-all-servers" checked>
                    <span class="hub-toggle__control" aria-hidden="true"></span>
                    <span class="hub-toggle__text">–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã</span>
                </label>
                <div class="hub-help">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ ‚Äî –≤—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –Ω–∏–∂–µ.</div>
                <label class="hub-label" for="agent-editor-allowed-servers">–†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã</label>
                <input id="agent-server-search" class="hub-input" placeholder="–ü–æ–∏—Å–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ –∏–º–µ–Ω–∏, —Ö–æ—Å—Ç—É –∏–ª–∏ –≥—Ä—É–ø–ø–µ">
                <div id="agent-server-groups" class="server-group-chips"></div>
                <div id="agent-server-list" class="server-picker"></div>
                <select id="agent-editor-allowed-servers" class="hub-select hidden" multiple></select>
            </div>

            <div class="agent-editor-section agent-editor-section--full">
                <h3>–ù–∞–≤—ã–∫–∏ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</h3>
                <div class="hub-form-row">
                    <div class="hub-field">
                        <label class="hub-label" for="agent-editor-skills">–ù–∞–≤—ã–∫–∏</label>
                        <select id="agent-editor-skills" class="hub-select" multiple></select>
                    </div>
                    <div class="hub-field">
                        <label class="hub-toggle">
                            <input type="checkbox" id="agent-editor-mcp-auto">
                            <span class="hub-toggle__control" aria-hidden="true"></span>
                            <span class="hub-toggle__text">MCP auto-approve</span>
                        </label>
                    </div>
                </div>
                <div class="hub-field">
                    <label class="hub-label">–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã</label>
                    <div id="agent-editor-tools" class="hub-tools"></div>
                </div>
            </div>

            <div class="agent-editor-actions">
                <button type="button" class="hub-btn hub-btn-primary" onclick="saveAgent()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∞–≥–µ–Ω—Ç–∞</button>
                <button type="button" class="hub-btn hub-btn-ghost" onclick="closeAgentEditor()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>

<div id="agentRunModal" class="hub-modal hidden" role="dialog" aria-modal="true" aria-labelledby="agent-run-title">
    <div class="hub-modal__backdrop" onclick="closeAgentRun()"></div>
    <div class="hub-modal__panel agent-run-panel">
        <div class="hub-modal__head">
            <h2 id="agent-run-title" class="hub-modal__title">–ó–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞</h2>
            <button class="hub-btn hub-btn-ghost hub-btn--icon" onclick="closeAgentRun()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        <form id="agent-run-form" class="hub-modal__body agent-run-grid">
            <div class="agent-run-section">
                <h3>–ó–∞–¥–∞—á–∞</h3>
                <div id="agent-run-name" class="agent-run-title"></div>
                <label class="hub-label" for="agent-run-task">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏</label>
                <textarea id="agent-run-task" class="hub-textarea" rows="6" placeholder="–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É, –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è"></textarea>
                <label class="hub-toggle">
                    <input type="checkbox" id="agent-run-auto" checked>
                    <span class="hub-toggle__control" aria-hidden="true"></span>
                    <span class="hub-toggle__text">–ê–≤—Ç–æ–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</span>
                </label>
                <div class="hub-help">–ï—Å–ª–∏ –≤—ã–∫–ª—é—á–µ–Ω–æ ‚Äî –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.</div>
            </div>
            <div class="agent-run-section">
                <h3>–ö–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—É—Å–∫–∞</h3>
                <div class="hub-field">
                    <label class="hub-label" for="agent-run-server">–°–µ—Ä–≤–µ—Ä</label>
                    <select id="agent-run-server" class="hub-select">
                        <option value="">–ë–µ–∑ —Å–µ—Ä–≤–µ—Ä–∞ / code workflow</option>
                    {% for server in servers_data %}
                    <option value="{{ server.id }}">{{ server.name }} ({{ server.host }})</option>
                    {% endfor %}
                    </select>
                </div>
                <div class="hub-field">
                    <label class="hub-label" for="agent-run-project">–ü—Ä–æ–µ–∫—Ç</label>
                    <select id="agent-run-project" class="hub-select">
                        <option value="">–ü—Ä–æ–µ–∫—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                    {% for project in projects_data %}
                    <option value="{{ project.path }}">{{ project.name }}</option>
                    {% endfor %}
                    </select>
                </div>
                <div class="hub-field">
                    <label class="hub-label" for="agent-run-runtime">Runtime</label>
                    <select id="agent-run-runtime" class="hub-select">
                        <option value="">auto</option>
                        <option value="cursor">cursor</option>
                        <option value="claude">claude</option>
                        <option value="codex">codex</option>
                        <option value="gemini">gemini</option>
                        <option value="grok">grok</option>
                    </select>
                </div>
            </div>
            <div class="agent-run-actions">
                <button type="button" class="hub-btn hub-btn-primary" onclick="submitAgentRun()">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
                <button type="button" class="hub-btn hub-btn-ghost" onclick="closeAgentRun()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </form>
    </div>
</div>
<!-- MCP Tools Modal -->
<div id="mcpToolsModal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="mcpToolsTitle" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeMcpTools()" aria-hidden="true"></div>
    <div class="absolute top-1/2 left-1/2 w-full max-w-3xl transform -translate-x-1/2 -translate-y-1/2 bg-bg-surface border border-white/10 rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-3">
            <div>
                <h2 id="mcpToolsTitle" class="text-xl font-bold text-white">MCP Tools</h2>
                <div id="mcpToolsMeta" class="text-xs text-gray-400 mt-1">Loading...</div>
            </div>
            <button type="button" onclick="closeMcpTools()" class="text-xs text-gray-400" aria-label="Close">Close</button>
        </div>
        <div id="mcpToolsList" class="space-y-2 max-h-[60vh] overflow-y-auto custom-scrollbar text-xs text-gray-200"></div>
    </div>
</div>

<!-- Workflow Logs Modal: —à–∞–≥–∏ —Å–ª–µ–≤–∞, –ª–æ–≥–∏ —Å–ø—Ä–∞–≤–∞, –∫–Ω–æ–ø–∫–∏ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å/–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å/–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å -->
<div id="workflowLogsModal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="workflowLogsTitle" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeWorkflowLogs()" aria-hidden="true"></div>
    <div class="absolute inset-4 md:inset-8 lg:inset-12 bg-bg-surface border border-white/10 rounded-2xl shadow-2xl flex flex-col overflow-hidden">
        <div class="flex items-center justify-between p-4 border-b border-white/10">
            <div>
                <h2 id="workflowLogsTitle" class="text-xl font-bold text-white flex items-center gap-2">
                    <svg class="w-5 h-5 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ Workflow
                </h2>
                <div id="workflowLogsMeta" class="text-sm text-gray-400 mt-1 flex items-center gap-2">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div class="flex items-center gap-2">
                <a id="workflowLogsOpenPage" href="#" class="px-3 py-1.5 text-sm bg-primary/20 hover:bg-primary/30 text-primary rounded-lg transition">–û—Ç–∫—Ä—ã—Ç—å –≤ –ª–æ–≥–∞—Ö</a>
                <div id="workflowLogsActions" class="flex gap-2 flex-wrap"></div>
                <button type="button" onclick="closeWorkflowLogs()" class="px-3 py-1.5 text-sm bg-white/5 hover:bg-white/10 text-gray-300 rounded-lg transition" aria-label="–ó–∞–∫—Ä—ã—Ç—å">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>
        <div class="flex-1 flex overflow-hidden min-h-0">
            <div class="w-80 border-r border-white/10 flex flex-col flex-shrink-0">
                <div class="p-3 border-b border-white/10 text-sm font-medium text-gray-400">–®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
                <div id="workflowStepsList" class="flex-1 overflow-y-auto custom-scrollbar p-2 space-y-2 min-h-0"></div>
            </div>
            <div class="flex-1 flex flex-col min-w-0">
                <div class="p-3 border-b border-white/10 text-sm font-medium text-gray-400 flex justify-between items-center">
                    <span>–õ–æ–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</span>
                    <span id="workflowLogsRetryInfo" class="text-xs text-yellow-400"></span>
                </div>
                <pre id="workflowLogsContent" class="flex-1 bg-bg-base m-2 rounded-xl p-4 text-xs text-gray-200 overflow-y-auto custom-scrollbar font-mono leading-relaxed min-h-0" style="white-space: pre-wrap; word-break: break-word;">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ–≥–æ–≤...</pre>
            </div>
        </div>
    </div>
</div>

<!-- Agent Logs Modal -->
<div id="agentLogsModal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="agentLogsTitle" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeAgentLogs()" aria-hidden="true"></div>
    <div class="absolute top-1/2 left-1/2 w-full max-w-3xl transform -translate-x-1/2 -translate-y-1/2 bg-bg-surface border border-white/10 rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-3">
        <div>
            <h2 id="agentLogsTitle" class="text-xl font-bold text-white">Agent logs</h2>
            <div id="agentLogsMeta" class="text-xs text-gray-400 mt-1">Loading...</div>
        </div>
        <div class="flex items-center gap-2">
            <a id="agentLogsOpenPage" href="#" class="px-3 py-1.5 text-xs bg-primary/20 hover:bg-primary/30 text-primary rounded-lg transition">–û—Ç–∫—Ä—ã—Ç—å –≤ –ª–æ–≥–∞—Ö</a>
            <button type="button" onclick="closeAgentLogs()" class="text-xs text-gray-400" aria-label="Close">Close</button>
        </div>
        </div>
        <pre id="agentLogsContent" class="bg-bg-base border border-white/10 rounded-xl p-3 text-xs text-gray-200 max-h-[60vh] overflow-y-auto"></pre>
    </div>
</div>

<!-- Workflow Script Modal -->
<div id="workflowScriptModal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="workflowScriptTitle" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeWorkflowScript()" aria-hidden="true"></div>
    <div class="absolute top-1/2 left-1/2 w-full max-w-4xl transform -translate-x-1/2 -translate-y-1/2 bg-bg-surface border border-white/10 rounded-2xl shadow-2xl p-6">
        <div class="flex items-center justify-between mb-3">
            <h2 id="workflowScriptTitle" class="text-xl font-bold text-white">Workflow script</h2>
            <div class="flex gap-2">
                <button type="button" onclick="exportWorkflow()" class="px-3 py-1.5 text-xs bg-primary/20 text-primary rounded-lg hover:bg-primary/30">üì§ Export JSON</button>
                <button type="button" onclick="closeWorkflowScript()" class="px-3 py-1.5 text-xs bg-white/5 hover:bg-white/10 text-gray-300 rounded-lg" aria-label="Close">Close</button>
            </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
            <div>
                <div class="text-xs text-gray-400 mb-2">JSON</div>
                <pre id="workflowScriptJson" class="bg-bg-base border border-white/10 rounded-xl p-3 text-xs text-gray-200 max-h-[55vh] overflow-y-auto"></pre>
            </div>
            <div>
                <div class="text-xs text-gray-400 mb-2">Ralph Script</div>
                <pre id="workflowScriptRalph" class="bg-bg-base border border-white/10 rounded-xl p-3 text-xs text-gray-200 max-h-[55vh] overflow-y-auto"></pre>
            </div>
        </div>
    </div>
</div>

<!-- Import Workflow Modal -->
<div id="importModal" class="fixed inset-0 z-[100] hidden" role="dialog" aria-modal="true" aria-labelledby="importModalTitle" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeImportModal()" aria-hidden="true"></div>
    <div class="absolute top-1/2 left-1/2 w-full max-w-2xl transform -translate-x-1/2 -translate-y-1/2 bg-bg-surface border border-white/10 rounded-2xl shadow-2xl p-6">
        <h2 id="importModalTitle" class="text-xl font-bold text-white mb-3">üì• –ò–º–ø–æ—Ä—Ç Workflow –∏–∑ —Ñ–∞–π–ª–∞</h2>
        <p class="text-sm text-gray-400 mb-4">–ó–∞–≥—Ä—É–∑–∏—Ç–µ JSON —Å –ø–æ–ª—è–º–∏ name, steps –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ runtime.</p>
        <form id="importForm" onsubmit="submitImport(event)">
            <div class="mb-4">
                <label class="block text-xs font-medium text-gray-400 mb-2">–§–∞–π–ª workflow (JSON)</label>
                <input type="file" id="import-file" accept=".json" required class="w-full bg-bg-base border border-white/10 rounded-lg px-3 py-3 text-white text-sm file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:bg-primary/20 file:text-primary hover:file:bg-primary/30">
                <div id="import-file-info" class="text-xs text-gray-500 mt-2 hidden"></div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">–ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ (Workspace)</label>
                    <select id="import-project" class="w-full bg-bg-base border border-white/10 rounded-lg px-3 py-2 text-white text-sm">
                        <option value="__new__">üìÅ New project</option>
                        {% for project in projects_data %}
                        <option value="{{ project.path }}">üìÇ {{ project.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div id="import-new-project-container">
                    <label class="block text-xs font-medium text-gray-400 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <input id="import-new-project-name" type="text" class="w-full bg-bg-base border border-white/10 rounded-lg px-3 py-2 text-white text-sm" placeholder="–ü–æ –Ω–∞–∑–≤–∞–Ω–∏—é workflow">
                </div>
            </div>
            <div id="import-preview" class="mb-4 hidden">
                <div class="text-xs font-medium text-gray-400 mb-2">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
                <div class="bg-bg-base border border-white/10 rounded-lg p-3 max-h-60 overflow-y-auto">
                    <div id="import-preview-content" class="text-sm text-gray-200"></div>
                </div>
            </div>
            <div class="flex justify-end gap-3">
                <button type="button" onclick="closeImportModal()" class="px-4 py-2 text-sm text-gray-400 hover:text-white">–û—Ç–º–µ–Ω–∞</button>
                <button type="submit" class="px-4 py-2 bg-primary hover:bg-primary-hover text-white text-sm rounded-lg">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
        </form>
    </div>
</div>

<!-- DEPRECATED: Profile Modal removed. Use Custom Agents (/agents/custom-agents/) instead -->

<!-- AI Analysis Wizard Modal -->
<div id="aiAnalysisModal" class="fixed inset-0 z-[200] hidden" role="dialog" aria-modal="true" aria-labelledby="aiAnalysisTitle" aria-hidden="true">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeAiAnalysisModal()" aria-hidden="true"></div>
    <div class="absolute top-1/2 left-1/2 w-full max-w-2xl max-h-[85vh] transform -translate-x-1/2 -translate-y-1/2 bg-bg-surface border border-white/10 rounded-2xl shadow-2xl flex flex-col overflow-hidden">
        <!-- Header with Progress -->
        <div class="p-4 border-b border-white/10 bg-gradient-to-r from-accent/10 to-primary/10">
            <div class="flex items-center justify-between mb-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-xl bg-accent/20 flex items-center justify-center">
                        <span class="text-xl">ü§ñ</span>
                    </div>
                    <div>
                        <h2 id="aiAnalysisTitle" class="text-lg font-bold text-white">AI –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫</h2>
                        <p id="ai-wizard-status" class="text-xs text-gray-400">Cursor CLI --mode=plan</p>
                    </div>
                </div>
                <button type="button" onclick="closeAiAnalysisModal()" class="text-gray-400 hover:text-white p-1 rounded-lg hover:bg-white/10">
                    <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
                </button>
            </div>
            <!-- Progress Bar -->
            <div class="flex items-center gap-2">
                <div class="flex-1 h-1.5 bg-white/10 rounded-full overflow-hidden">
                    <div id="ai-wizard-progress" class="h-full bg-gradient-to-r from-accent to-primary transition-all duration-500" style="width: 0%"></div>
                </div>
                <span id="ai-wizard-step" class="text-xs text-gray-400 min-w-[80px] text-right">–®–∞–≥ 1: –ó–∞–¥–∞—á–∞</span>
            </div>
        </div>
        
        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-4">
            <!-- Step 1: Initial Task Input -->
            <div id="ai-step-input" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É</label>
                    <textarea id="ai-analysis-task" rows="5" class="w-full bg-bg-base border border-white/10 rounded-xl px-4 py-3 text-white text-sm focus:border-accent/50 focus:ring-1 focus:ring-accent/30 transition-all" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?&#10;&#10;–ù–∞–ø—Ä–∏–º–µ—Ä: –°–æ–∑–¥–∞—Ç—å REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —Å JWT –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π, –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –∏ —Ç–µ—Å—Ç–∞–º–∏"></textarea>
                </div>
                <div class="bg-accent/10 border border-accent/20 rounded-xl p-3">
                    <div class="flex items-start gap-2">
                        <span class="text-lg">üí°</span>
                        <div class="text-xs text-gray-300">
                            <p class="font-medium text-accent mb-1">–°–æ–≤–µ—Ç—ã –¥–ª—è –ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:</p>
                            <ul class="space-y-0.5 text-gray-400">
                                <li>‚Ä¢ –£–∫–∞–∂–∏—Ç–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –∏ –≤–µ—Ä—Å–∏–∏ (Django 5, React 18)</li>
                                <li>‚Ä¢ –û–ø–∏—à–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–±–µ–∑ Docker, —Ç–æ–ª—å–∫–æ SQLite)</li>
                                <li>‚Ä¢ –£–∫–∞–∂–∏—Ç–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (—Ç–µ—Å—Ç—ã, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Step 2: All Questions at once -->
            <div id="ai-step-questions" class="hidden space-y-4">
                <div class="bg-accent/10 border border-accent/20 rounded-xl p-3 mb-4">
                    <div class="flex items-center gap-2">
                        <span class="text-lg">‚ùì</span>
                        <p class="text-sm text-white">AI –∑–∞–¥–∞–ª —É—Ç–æ—á–Ω—è—é—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã. –û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å Workflow"</p>
                    </div>
                </div>
                
                <!-- All Questions List -->
                <div id="ai-all-questions" class="space-y-4">
                    <!-- Questions will be rendered here -->
                </div>
            </div>
            
            <!-- Step: Loading -->
            <div id="ai-step-loading" class="hidden py-12">
                <div class="flex flex-col items-center justify-center gap-4">
                    <div class="relative">
                        <div class="w-16 h-16 rounded-full border-4 border-accent/20 border-t-accent animate-spin"></div>
                        <div class="absolute inset-0 flex items-center justify-center">
                            <span class="text-2xl">ü§ñ</span>
                        </div>
                    </div>
                    <div class="text-center">
                        <p id="ai-loading-text" class="text-white font-medium">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...</p>
                        <p id="ai-loading-hint" class="text-xs text-gray-400 mt-1">AI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–∞—à—É –∑–∞–¥–∞—á—É</p>
                    </div>
                </div>
            </div>
            
            <!-- Step: Final Result -->
            <div id="ai-step-result" class="hidden space-y-4">
                <div class="bg-green-500/10 border border-green-500/30 rounded-xl p-4">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
                            <span class="text-xl">‚úÖ</span>
                        </div>
                        <div>
                            <h3 class="text-white font-semibold">Workflow –≥–æ—Ç–æ–≤!</h3>
                            <p class="text-xs text-gray-400">AI —Å–æ–∑–¥–∞–ª –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-2 text-center">
                        <div class="bg-white/5 rounded-lg p-2">
                            <div id="ai-final-steps" class="text-lg font-bold text-white">0</div>
                            <div class="text-xs text-gray-400">—à–∞–≥–æ–≤</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-2">
                            <div id="ai-final-complexity" class="text-lg font-bold text-accent">-</div>
                            <div class="text-xs text-gray-400">—Å–ª–æ–∂–Ω–æ—Å—Ç—å</div>
                        </div>
                        <div class="bg-white/5 rounded-lg p-2">
                            <div id="ai-final-model" class="text-lg font-bold text-primary">auto</div>
                            <div class="text-xs text-gray-400">–º–æ–¥–µ–ª—å</div>
                        </div>
                    </div>
                </div>
                
                <!-- Final Steps Preview -->
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-sm font-medium text-white">–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ —à–∞–≥–∏:</h4>
                    </div>
                    <div id="ai-final-steps-list" class="space-y-2 max-h-[200px] overflow-y-auto">
                        <!-- Steps will be added here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="p-4 border-t border-white/10 bg-bg-base/50">
            <div class="flex items-center justify-between gap-3">
                <button type="button" onclick="closeAiAnalysisModal()" class="px-4 py-2 text-sm text-gray-400 hover:text-white transition-colors">
                    –û—Ç–º–µ–Ω–∞
                </button>
                <div class="flex gap-2">
                    <!-- Start Analysis (Step 1) -->
                    <button type="button" id="btn-wizard-start" onclick="wizardStart()" class="px-5 py-2.5 bg-accent hover:bg-accent/80 text-white text-sm rounded-lg font-medium flex items-center gap-2 transition-all">
                        <span>üöÄ</span> –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å
                    </button>
                    <!-- Submit Answers (Step 2) -->
                    <button type="button" id="btn-wizard-submit" onclick="wizardSubmitAnswers()" class="hidden px-5 py-2.5 bg-accent hover:bg-accent/80 text-white text-sm rounded-lg font-medium flex items-center gap-2 transition-all">
                        <span>üìã</span> –°–æ–∑–¥–∞—Ç—å Workflow
                    </button>
                    <!-- Apply Result (Final) -->
                    <button type="button" id="btn-wizard-apply" onclick="wizardApply()" class="hidden px-5 py-2.5 bg-primary hover:bg-primary-hover text-white text-sm rounded-lg font-medium flex items-center gap-2 transition-all">
                        <span>‚úì</span> –ü—Ä–∏–º–µ–Ω–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Task Builder Modal (–í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä –∑–∞–¥–∞—á) -->
<div id="taskBuilderModal" class="hub-modal hidden tb-modal" role="dialog" aria-modal="true" aria-labelledby="taskBuilderTitle" aria-hidden="true">
    <div class="hub-modal__backdrop" onclick="closeTaskBuilder()" aria-hidden="true"></div>
    <div class="hub-modal__panel tb-panel">
        <div class="tb-header">
            <div>
                <h2 id="taskBuilderTitle" class="tb-title">–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä workflow</h2>
                <div class="tb-sub">–°–æ–±–µ—Ä–∏—Ç–µ —à–∞–≥–∏, —Å—Ä–µ–¥—É –∏ –ø—Ä–æ–µ–∫—Ç. –ú–æ–¥–µ–ª—å –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.</div>
            </div>
            <div class="tb-header__actions">
                <button type="button" onclick="closeTaskBuilder()" class="hub-btn hub-btn-ghost hub-btn--icon" aria-label="–ó–∞–∫—Ä—ã—Ç—å">–ó–∞–∫—Ä—ã—Ç—å</button>
            </div>
        </div>

        <div class="tb-body">
            <aside class="tb-sidebar">
                <div class="tb-section">
                    <div class="tb-section__title">–û—Å–Ω–æ–≤–Ω–æ–µ</div>
                    <label class="hub-label" for="tb-workflow-name">–ù–∞–∑–≤–∞–Ω–∏–µ workflow</label>
                    <input id="tb-workflow-name" type="text" class="hub-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Deploy & —Ç–µ—Å—Ç—ã">
                    <label class="hub-label" for="tb-project-description">–û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <textarea id="tb-project-description" rows="4" class="hub-textarea" placeholder="–û–ø–∏—à–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç: —Ü–µ–ª–∏, –∫–æ–Ω—Ç–µ–∫—Å—Ç, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –∫—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏"></textarea>
                </div>

                <div class="tb-section tb-ai">
                    <div class="tb-section__title">AI –ê–Ω–∞–ª–∏–∑</div>
                    <button type="button" id="btn-smart-analyze" onclick="openAiAnalysisModal()" class="hub-btn hub-btn-secondary">–ó–∞–ø—É—Å—Ç–∏—Ç—å AI –∞–Ω–∞–ª–∏–∑</button>
                    <p class="hub-help">AI –ø—Ä–æ—á–∏—Ç–∞–µ—Ç –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç —à–∞–≥–∏, —Ç–µ—Å—Ç—ã –∏ –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.</p>
                </div>

                <div class="tb-section">
                    <div class="tb-section__title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
                    <label class="hub-label" for="tb-runtime">–†–∞–Ω—Ç–∞–π–º</label>
                    <select id="tb-runtime" class="hub-select">
                        <option value="cursor" selected>Cursor CLI</option>
                        <option value="ralph">Ralph Orchestrator</option>
                    </select>

                    <input type="hidden" id="tb-workflow-model" value="auto">

                    <label class="hub-label" for="tb-project">–ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞</label>
                    <select id="tb-project" class="hub-select">
                        <option value="__new__">üìÅ –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</option>
                        {% for project in projects_data %}
                        <option value="{{ project.path }}">üìÇ {{ project.name }}</option>
                        {% endfor %}
                    </select>

                    <div id="tb-new-project-container">
                        <label class="hub-label" for="tb-new-project-name">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</label>
                        <input id="tb-new-project-name" type="text" class="hub-input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: payments-refactor">
                    </div>

                    <label class="hub-label" for="tb-target-server">–¶–µ–ª–µ–≤–æ–π —Å–µ—Ä–≤–µ—Ä (SSH)</label>
                    <select id="tb-target-server" class="hub-select">
                        <option value="">–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã (–∞–≥–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç —Å–∞–º)</option>
                        {% for server in servers_data %}
                        <option value="{{ server.id }}">üñ•Ô∏è {{ server.name }} ({{ server.host }})</option>
                        {% endfor %}
                    </select>
                    <p class="hub-help">–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω ‚Äî –∞–≥–µ–Ω—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å —ç—Ç–∏–º —Å–µ—Ä–≤–µ—Ä–æ–º.</p>
                </div>

                <div class="tb-section tb-stats">
                    <div class="tb-section__title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
                    <div class="tb-stats-row">
                        <span>–ó–∞–¥–∞—á</span>
                        <span id="tb-tasks-count">0</span>
                    </div>
                    <div class="tb-stats-row">
                        <span>–° —Ç–µ—Å—Ç–∞–º–∏</span>
                        <span id="tb-tests-count">0</span>
                    </div>
                </div>
            </aside>

            <div class="tb-tasks">
                <div class="tb-tasks-header">
                    <div>
                        <div class="tb-section__title">–ó–∞–¥–∞—á–∏</div>
                        <div class="hub-help">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Ä—è–¥–∫–∞.</div>
                    </div>
                    <button onclick="addNewTask()" class="hub-btn hub-btn-secondary">+ –î–æ–±–∞–≤–∏—Ç—å</button>
                </div>

                <div id="tb-tasks-container" class="tb-tasks-list">
                    <div id="tb-empty-state" class="tb-empty">
                        <div class="tb-empty__title">–ó–∞–¥–∞—á –ø–æ–∫–∞ –Ω–µ—Ç</div>
                        <div class="hub-help">–î–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É –≤—Ä—É—á–Ω—É—é –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ AI –ê–Ω–∞–ª–∏–∑ —Å–ª–µ–≤–∞.</div>
                        <button onclick="addNewTask()" class="hub-btn hub-btn-primary">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="tb-footer">
            <button onclick="clearAllTasks()" class="hub-btn hub-btn-ghost">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
            <div class="tb-footer__actions">
                <button onclick="closeTaskBuilder()" class="hub-btn hub-btn-ghost">–û—Ç–º–µ–Ω–∞</button>
                <button id="btn-save-workflow" onclick="saveTaskBuilderWorkflow()" class="hub-btn hub-btn-secondary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å workflow</button>
                <button id="btn-save-run-workflow" onclick="saveAndRunTaskBuilderWorkflow()" class="hub-btn hub-btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<!-- Task Template (hidden) -->
<template id="task-card-template">
    <div class="task-card" draggable="true">
        <div class="task-card__head">
            <div class="drag-handle" aria-hidden="true">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"/>
                </svg>
            </div>
            <div class="task-number">1</div>
            <div class="task-card__meta">
                <input type="text" class="task-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏">
                <div class="task-card__subtitle">–®–∞–≥ workflow</div>
            </div>
            <button class="delete-task-btn" onclick="deleteTask(this)" aria-label="–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É">
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                </svg>
            </button>
        </div>

        <div class="task-card__body">
            <textarea class="task-prompt" rows="3" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (—á—Ç–æ –¥–æ–ª–∂–µ–Ω —Å–¥–µ–ª–∞—Ç—å –∞–≥–µ–Ω—Ç)..."></textarea>

            <div class="task-model-section hidden">
                <div class="task-model-row">
                    <label class="task-inline-label">–ú–æ–¥–µ–ª—å</label>
                    <select class="task-model">
                        <option value="auto" selected>Auto (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)</option>
                    </select>
                </div>
            </div>

            <div class="task-test-section">
                <button class="toggle-test-btn" onclick="toggleTestSection(this)" type="button">
                    <span class="test-icon">‚ñ∂</span> –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç
                </button>
                <div class="test-content hidden">
                    <label class="task-inline-label">Verify step ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ (verify_prompt)</label>
                    <textarea class="task-verify" rows="2" placeholder="–ß—Ç–æ –¥–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏ –∞–≥–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –¥–∞–ª—å—à–µ (–Ω–∞–ø—Ä. <promise>PASS</promise>). –ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã –µ—Å–ª–∏ –Ω—É–∂–Ω–æ."></textarea>
                    <div class="task-test-grid">
                        <div>
                            <label class="task-inline-label">Completion Promise</label>
                            <input type="text" class="task-promise" value="STEP_DONE">
                        </div>
                        <div>
                            <label class="task-inline-label">Verify Promise</label>
                            <input type="text" class="task-verify-promise" value="PASS">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

{{ presets_data|json_script:"preset-data" }}
{{ workflows_data|json_script:"workflows-data" }}
{{ projects_data|json_script:"projects-data" }}
{{ servers_data|json_script:"servers-data" }}
{% endblock %}

{% block scripts %}
<script src="{% static 'js/agent_hub.js' %}?v=hub-v6"></script>
{% endblock %}
