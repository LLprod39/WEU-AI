{% extends 'base.html' %}
{% load static %}

{% block body_extra_class %}page-admin-logs{% endblock %}
{% block title %}Debug Console - WEU AI{% endblock %}
{% block header_title %}Debug Console{% endblock %}

{% block content %}
<div class="admin-logs-container">
    <div class="admin-logs-header">
        <div class="header-content">
            <div class="header-badge">ADMIN</div>
            <h1 class="header-title">Debug Console</h1>
            <p class="header-subtitle">Live monitoring, full context, edit & replay</p>
        </div>
        <div class="header-controls">
            <button type="button" id="adminLogsAutoToggle" class="control-btn active" data-active="true">
                <span class="control-icon">‚óè</span>
                <span>Live</span>
            </button>
            <button type="button" id="adminLogsRefreshBtn" class="control-btn">
                <span class="control-icon">‚Üª</span>
                <span>Refresh</span>
            </button>
        </div>
    </div>

    <div class="admin-logs-layout">
        <!-- Sidebar: Runs List + Filters -->
        <aside class="admin-sidebar" id="adminSidebar">
            <button type="button" class="sidebar-toggle" id="sidebarToggle" title="–°–≤–µ—Ä–Ω—É—Ç—å/—Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å">
                <span class="toggle-icon">‚óÄ</span>
            </button>
            <div class="sidebar-section">
                <h3 class="section-title">Filters</h3>
                <div class="filters-grid">
                    <input id="adminLogsSearch" type="text" class="filter-input" placeholder="Search runs..." />
                    <select id="adminLogsType" class="filter-select">
                        <option value="all">All Types</option>
                        <option value="run">Agent Run</option>
                        <option value="workflow">Workflow Run</option>
                    </select>
                    <select id="adminLogsStatus" class="filter-select">
                        <option value="all">All Status</option>
                        <option value="queued">Queued</option>
                        <option value="running">Running</option>
                        <option value="succeeded">Succeeded</option>
                        <option value="failed">Failed</option>
                        <option value="paused">Paused</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                    <select id="adminLogsRuntime" class="filter-select">
                        <option value="all">All Runtimes</option>
                        <option value="cursor">cursor</option>
                        <option value="claude">claude</option>
                        <option value="gemini">gemini</option>
                        <option value="grok">grok</option>
                        <option value="internal">internal</option>
                        <option value="ralph">ralph</option>
                    </select>
                </div>
            </div>

            <div class="sidebar-section runs-section">
                <h3 class="section-title">Runs <span id="runsCount" class="count-badge">0</span></h3>
                <div id="adminRunsList" class="runs-list"></div>
                <div id="adminRunsEmpty" class="runs-empty hidden">No runs found</div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <!-- Run Header -->
            <div class="run-header" id="runHeader">
                <div class="run-info">
                    <div class="run-label">Selected Run</div>
                    <h2 id="adminRunTitle" class="run-title">‚Äî</h2>
                    <div id="adminRunMeta" class="run-meta">‚Äî</div>
                </div>
                <div class="run-actions">
                    <button type="button" id="adminRunSaveBtn" class="action-btn save-btn">
                        <span class="btn-icon">üíæ</span>
                        <span>Save</span>
                    </button>
                    <button type="button" id="adminRunRestartBtn" class="action-btn restart-btn">
                        <span class="btn-icon">‚ñ∂</span>
                        <span>Restart</span>
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="tabs-nav">
                <button type="button" class="tab-btn active" data-tab="events">üìä –°–æ–±—ã—Ç–∏—è</button>
                <button type="button" class="tab-btn" data-tab="command">‚öôÔ∏è –ö–æ–º–∞–Ω–¥–∞ & –ê—Ä–≥—É–º–µ–Ω—Ç—ã</button>
                <button type="button" class="tab-btn" data-tab="console">üñ•Ô∏è –ö–æ–Ω—Å–æ–ª—å</button>
                <button type="button" class="tab-btn" data-tab="context">üìù –†–µ–¥–∞–∫—Ç–æ—Ä</button>
                <button type="button" class="tab-btn" data-tab="details">üîç –î–µ—Ç–∞–ª–∏</button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content active" data-tab="events">
                <div class="events-container">
                    <div class="events-toolbar">
                        <div class="toolbar-info">üìä –°–æ–±—ã—Ç–∏—è —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ —Ç–∏–ø—É (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã)</div>
                        <input type="text" id="eventsSearchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫..." />
                        <div class="events-filters">
                            <button type="button" class="filter-chip active" data-filter="all">–í—Å–µ</button>
                            <button type="button" class="filter-chip" data-filter="assistant">Assistant</button>
                            <button type="button" class="filter-chip" data-filter="tool_call">Tools</button>
                            <button type="button" class="filter-chip" data-filter="cmd">–ö–æ–º–∞–Ω–¥—ã</button>
                            <button type="button" class="filter-chip" data-filter="error">–û—à–∏–±–∫–∏</button>
                        </div>
                    </div>
                    <div id="adminEventsTimeline" class="events-timeline"></div>
                    <div id="eventsEmpty" class="events-empty hidden">No events yet</div>
                </div>
            </div>

            <div class="tab-content" data-tab="command">
                <div class="command-container">
                    <div class="command-section">
                        <h3 class="command-section-title">üéØ –ü–æ–ª–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞ CLI</h3>
                        <div class="command-info-text">
                            <strong>–î–ª—è AgentRun:</strong> –ø–æ–∫–∞–∑–∞–Ω–∞ –∫–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞.<br>
                            <strong>–î–ª—è WorkflowRun:</strong> –ø–æ–∫–∞–∑–∞–Ω—ã –∫–æ–º–∞–Ω–¥—ã –≤—Å–µ—Ö —à–∞–≥–æ–≤ (‚ñ∂ = —Ç–µ–∫—É—â–∏–π —à–∞–≥).
                        </div>
                        <pre id="adminCommandFull" class="command-output">‚Äî</pre>
                        <button type="button" id="adminCopyCommand" class="toolbar-btn-inline">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
                    </div>

                    <div class="command-section">
                        <h3 class="command-section-title">üìÑ –í—Ö–æ–¥–Ω–æ–π –ø—Ä–æ–º–ø—Ç (—á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–æ –∞–≥–µ–Ω—Ç—É)</h3>
                        <div class="command-info-text">
                            –ü–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏, –≤–∫–ª—é—á–∞—è —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤.<br>
                            <strong>–î–ª—è WorkflowRun:</strong> –ø–æ–∫–∞–∑–∞–Ω –ø—Ä–æ–º–ø—Ç —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞.
                        </div>
                        <pre id="adminPromptFull" class="command-output">‚Äî</pre>
                        <button type="button" id="adminCopyPromptFull" class="toolbar-btn-inline">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–ø—Ç</button>
                    </div>

                    <div class="command-section">
                        <h3 class="command-section-title">‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (config)</h3>
                        <div class="command-info-text">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—É—Å–∫–∞: workspace, –º–æ–¥–µ–ª—å, —Ñ–ª–∞–≥–∏, MCP –∏ —Ç.–¥.</div>
                        <pre id="adminConfigFull" class="command-output">‚Äî</pre>
                        <button type="button" id="adminCopyConfigFull" class="toolbar-btn-inline">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å config</button>
                    </div>

                    <div class="command-section">
                        <h3 class="command-section-title">üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è</h3>
                        <div class="command-info-text">ENV –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—É (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤).</div>
                        <pre id="adminEnvVars" class="command-output">‚Äî</pre>
                    </div>

                    <div class="command-section">
                        <h3 class="command-section-title">üîå MCP –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è</h3>
                        <div class="command-info-text">MCP —Å–µ—Ä–≤–µ—Ä—ã –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∞–≥–µ–Ω—Ç—É.</div>
                        <pre id="adminMcpConfig" class="command-output">‚Äî</pre>
                    </div>
                </div>
            </div>

            <div class="tab-content" data-tab="console">
                <div class="console-container">
                    <div class="console-toolbar">
                        <div class="toolbar-info">üì∫ –ü–æ–ª–Ω—ã–π –≤—ã–≤–æ–¥ stdout/stderr –æ—Ç CLI –∞–≥–µ–Ω—Ç–∞</div>
                        <button type="button" id="consoleCopyBtn" class="toolbar-btn">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë</button>
                    </div>
                    <pre id="adminRawLogs" class="console-output">‚Äî</pre>
                </div>
            </div>

            <div class="tab-content" data-tab="context">
                <div class="context-container">
                    <div class="context-toolbar">
                        <div class="toolbar-info">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä—É–π –∏ –∂–º–∏ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª –≤–≤–µ—Ä—Ö—É, –∑–∞—Ç–µ–º ¬´–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å¬ª</div>
                    </div>
                    <div class="context-grid">
                        <div class="context-field">
                            <label class="field-label">üìù –ó–∞–¥–∞—á–∞ (–¥–ª—è AgentRun)</label>
                            <textarea id="adminPromptInput" rows="12" placeholder="–ù–µ—Ç –∑–∞–ø—É—Å–∫–∞"></textarea>
                        </div>
                        <div class="context-field">
                            <label class="field-label">‚öôÔ∏è Config (JSON)</label>
                            <textarea id="adminConfigInput" rows="12" placeholder="–ù–µ—Ç config"></textarea>
                        </div>
                        <div class="context-field full-width">
                            <label class="field-label">üìã Workflow Script (JSON, —Ç–æ–ª—å–∫–æ –¥–ª—è WorkflowRun)</label>
                            <textarea id="adminWorkflowScript" rows="14" placeholder="–¢–æ–ª—å–∫–æ –¥–ª—è Workflow"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="tab-content" data-tab="details">
                <div class="details-container">
                    <pre id="adminRunDetails" class="details-output">‚Äî</pre>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/admin_logs_page.js' %}"></script>
{% endblock %}
