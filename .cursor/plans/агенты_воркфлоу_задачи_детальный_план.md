# –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω: –ê–≥–µ–Ω—Ç—ã, –≤–æ—Ä–∫—Ñ–ª–æ—É –∏ –ª–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á

## –í–≤–µ–¥–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–¥–∞—á:
1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º, MCP, –≤–µ–±—Ö—É–∫–∏)
2. –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π (AgentProfile) –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤–æ—Ä–∫—Ñ–ª–æ—É (–Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É, —Å–∫—Ä—ã—Ç—å —Å UI)
3. –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ –ª–æ–≥–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Å –ò–ò-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

–ü–ª–∞–Ω –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ —Ñ–∞–π–ª–∞–º, –º–∏–≥—Ä–∞—Ü–∏—è–º, —Ç–µ—Å—Ç–∞–º –∏ –ø–æ—à–∞–≥–æ–≤—ã–º –¥–µ–π—Å—Ç–≤–∏—è–º –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –±–µ–∑ –ø–æ–ª–æ–º–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.

---

## –¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥–µ–ª–∏

**[agent_hub/models.py](agent_hub/models.py):**
- `AgentProfile` ‚Äî –ø—Ä–æ—Ñ–∏–ª–∏ –∞–≥–µ–Ω—Ç–æ–≤ (agent_type, runtime, mode, config, mcp_servers). FK –≤ `AgentRun.profile`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è UI –≤—ã–±–æ—Ä–∞ –∏ –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞.
- `CustomAgent` ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã —Å system_prompt, instructions, allowed_tools, mcp_servers, runtime. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:** –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, –≤–µ–±—Ö—É–∫–∏.
- `AgentWorkflow` ‚Äî –≤–æ—Ä–∫—Ñ–ª–æ—É —Å target_server (FK –Ω–∞ Server), script, runtime.
- `AgentRun` ‚Äî –∑–∞–ø—É—Å–∫–∏ –∞–≥–µ–Ω—Ç–æ–≤ —Å profile FK (null=True).

**[tasks/models.py](tasks/models.py):**
- `Task` ‚Äî –∑–∞–¥–∞—á–∏ —Å –ø–æ–ª—è–º–∏ `ai_agent_type` (CharField: react/simple/complex/ralph), `target_server` (FK –Ω–∞ Server), `assigned_to_ai`, `ai_execution_status`.
- `TaskNotification` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –¥–ª—è –∑–∞–¥–∞—á.
- `TaskExecution` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

### Views –∏ API

**[agent_hub/views_legacy.py](agent_hub/views_legacy.py):**
- `api_profiles_*` ‚Äî CRUD –¥–ª—è AgentProfile.
- `api_agent_run` ‚Äî –∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞ (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç `profile_id`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç profile –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è agent_type/runtime/config).
- `api_assist_auto` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è –∏/–∏–ª–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É –ø–æ –∑–∞–¥–∞—á–µ (action: "profile" / "workflow" / "both"). –°–æ–∑–¥–∞—ë—Ç AgentProfile –ø—Ä–∏ action="profile" –∏–ª–∏ "both".
- `api_custom_agents_*` ‚Äî CRUD –¥–ª—è CustomAgent.
- `create_workflow_from_task` / `api_workflow_from_task` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–∫—Ñ–ª–æ—É –∏–∑ –∑–∞–¥–∞—á–∏.

**[tasks/views.py](tasks/views.py):**
- `task_create` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –∑–∞–ø—É—Å–∫ `_background_analyze_task` –≤ –ø–æ—Ç–æ–∫–µ.
- `notification_action` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º (approve, change_server, answer_questions).

**[tasks/smart_analyzer.py](tasks/smart_analyzer.py):**
- `SmartTaskAnalyzer.analyze_task` ‚Äî –∞–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á–∏: –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤, –≤—ã–∑–æ–≤ `TaskAIAssistant.analyze_task`, —Å–æ–∑–¥–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

**[tasks/ai_assistant.py](tasks/ai_assistant.py):**
- `TaskAIAssistant.analyze_task(title, description, servers_context)` ‚Äî –ø—Ä–æ–º–ø—Ç –≤ LLM, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `can_delegate_to_ai`, `reason`, `recommended_agent` (react/simple/complex/ralph), `missing_info`, `risks`.

### –®–∞–±–ª–æ–Ω—ã

**[agent_hub/templates/agent_hub/agents.html](agent_hub/templates/agent_hub/agents.html):**
- –°–µ–∫—Ü–∏—è "Workflows" ‚Äî —Å–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Ñ–ª–æ—É.
- –°–µ–∫—Ü–∏—è "Profiles" (id="profile-list") ‚Äî —Å–ø–∏—Å–æ–∫ AgentProfile —Å –∫–Ω–æ–ø–∫–∞–º–∏ Run/Configure.
- –§—É–Ω–∫—Ü–∏–∏ JS: `runProfile(id)`, `editProfile(id)`, –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è.

**[agent_hub/templates/agent_hub/agents_new.html](agent_hub/templates/agent_hub/agents_new.html):**
- –°–ø–∏—Å–æ–∫ –ø—Ä–æ—Ñ–∏–ª–µ–π (profiles) –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.
- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (id="profileModal").

**[agent_hub/templates/agent_hub/custom_agents.html](agent_hub/templates/agent_hub/custom_agents.html):**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –∞–≥–µ–Ω—Ç–∞–º–∏ (—Å–æ–∑–¥–∞–Ω–∏–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —ç–∫—Å–ø–æ—Ä—Ç).
- –§–æ—Ä–º—ã –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ system_prompt, instructions, allowed_tools, mcp_servers.

---

## –ó–∞–¥–∞—á–∞ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤

### –¶–µ–ª—å

–†–∞—Å—à–∏—Ä–∏—Ç—å –º–æ–¥–µ–ª—å `CustomAgent` (–∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–æ–¥–µ–ª—å ¬´Agent¬ª) —Å:
- –î–æ—Å—Ç—É–ø–æ–º –∫ —Å–µ—Ä–≤–µ—Ä–∞–º (allowed_servers): `null` –∏–ª–∏ `"all"` = –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã; `[id1, id2, ...]` = —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ.
- –ë–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π (knowledge_base): TextField –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞/—Ñ–∞–π–ª–æ–≤, –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ–º—ã—Ö –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç.
- –í–µ–±—Ö—É–∫–∞–º–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –º–æ–¥–µ–ª—å `AgentWebhook` –¥–ª—è —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤ (—Å–æ–±—ã—Ç–∏–µ ‚Üí –∑–∞–ø—É—Å–∫ –∞–≥–µ–Ω—Ç–∞).

### –®–∞–≥–∏

#### 1.1. –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è CustomAgent

**–§–∞–π–ª:** `agent_hub/migrations/0010_add_agent_servers_knowledge.py`

**–î–µ–π—Å—Ç–≤–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `allowed_servers` –≤ `CustomAgent`:
  ```python
  allowed_servers = models.JSONField(
      default=None,
      null=True,
      blank=True,
      help_text='null/"all" = –≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, [id1, id2, ...] = —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã'
  )
  ```
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `knowledge_base` –≤ `CustomAgent`:
  ```python
  knowledge_base = models.TextField(
      blank=True,
      help_text="–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∞–≥–µ–Ω—Ç–∞: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–∏–º–µ—Ä—ã (–ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç)"
  )
  ```

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python manage.py makemigrations agent_hub --name add_agent_servers_knowledge
python manage.py migrate
```

#### 1.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ CustomAgent

**–§–∞–π–ª:** `agent_hub/models.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è `allowed_servers` –∏ `knowledge_base` (—Å–º. –º–∏–≥—Ä–∞—Ü–∏—é).
- –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç–æ–¥ `get_allowed_servers(user)` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤:
  ```python
  def get_allowed_servers(self, user):
      """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç QuerySet —Å–µ—Ä–≤–µ—Ä–æ–≤, –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞–≥–µ–Ω—Ç—É"""
      from servers.models import Server
      if self.allowed_servers is None or self.allowed_servers == "all":
          return Server.objects.filter(user=user, is_active=True)
      elif isinstance(self.allowed_servers, list):
          return Server.objects.filter(user=user, is_active=True, id__in=self.allowed_servers)
      return Server.objects.none()
  ```
- –û–±–Ω–æ–≤–∏—Ç—å `to_cli_agent_config()` –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è knowledge_base –≤ system_prompt.

#### 1.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞

**–§–∞–π–ª:** `agent_hub/templates/agent_hub/custom_agents.html`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –í —Ñ–æ—Ä–º–µ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–∞ –¥–æ–±–∞–≤–∏—Ç—å:
  - **–í—ã–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–æ–≤:** `<select multiple>` —Å –æ–ø—Ü–∏–µ–π "–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã" (–∑–Ω–∞—á–µ–Ω–∏–µ `"all"`) –∏–ª–∏ —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
  - **–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π:** `<textarea>` –¥–ª—è knowledge_base.
  
**–ü—Ä–∏–º–µ—Ä —Ä–∞–∑–º–µ—Ç–∫–∏:**
```html
<div class="form-group">
    <label for="agent-allowed-servers">–î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º</label>
    <select id="agent-allowed-servers" multiple class="form-control">
        <option value="all">–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã</option>
        <!-- –°–µ—Ä–≤–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </select>
    <small class="form-text text-muted">–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä—ã, –∫ –∫–æ—Ç–æ—Ä—ã–º –∞–≥–µ–Ω—Ç –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è. "–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã" = –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º.</small>
</div>

<div class="form-group">
    <label for="agent-knowledge-base">–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</label>
    <textarea id="agent-knowledge-base" rows="8" class="form-control" placeholder="–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Ç–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è..."></textarea>
    <small class="form-text text-muted">–≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –∞–≥–µ–Ω—Ç–∞.</small>
</div>
```

**–§–∞–π–ª:** `agent_hub/static/js/custom_agents.js` (–µ—Å–ª–∏ –µ—Å—Ç—å) –∏–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å JS –≤ —à–∞–±–ª–æ–Ω.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ JS:**
- –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Ñ–æ—Ä–º—ã (GET `/api/servers/` –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ `servers_data`).
- –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∞–≥–µ–Ω—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å `allowed_servers` (null –µ—Å–ª–∏ "–í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã", –∏–Ω–∞—á–µ –º–∞—Å—Å–∏–≤ ID).
- –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–æ–ª–Ω—è—Ç—å –ø–æ–ª—è `allowed_servers` –∏ `knowledge_base`.

#### 1.4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ API –¥–ª—è CustomAgent

**–§–∞–π–ª:** `agent_hub/views_legacy.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `api_custom_agents_list` (POST ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ):**
```python
# –ü–æ—Å–ª–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ data:
allowed_servers_raw = data.get('allowed_servers')
if allowed_servers_raw == 'all' or allowed_servers_raw is None:
    allowed_servers = None  # –í—Å–µ —Å–µ—Ä–≤–µ—Ä—ã
elif isinstance(allowed_servers_raw, list):
    # –í–∞–ª–∏–¥–∞—Ü–∏—è: –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ ID —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    from servers.models import Server
    valid_ids = Server.objects.filter(user=request.user, is_active=True, id__in=allowed_servers_raw).values_list('id', flat=True)
    allowed_servers = list(valid_ids)
else:
    allowed_servers = None

knowledge_base = data.get('knowledge_base', '').strip()

agent = CustomAgent.objects.create(
    owner=request.user,
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è ...
    allowed_servers=allowed_servers,
    knowledge_base=knowledge_base,
)
```

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `api_custom_agent_detail` (PUT ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ):**
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å `allowed_servers` –∏ `knowledge_base`.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `api_custom_agents_list` (GET ‚Äî —Å–ø–∏—Å–æ–∫):**
- –î–æ–±–∞–≤–∏—Ç—å –≤ –æ—Ç–≤–µ—Ç –ø–æ–ª—è `allowed_servers` –∏ `knowledge_base`.

#### 1.5. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã Custom Agents –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤

**–§–∞–π–ª:** `agent_hub/views/pages.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `custom_agents_view`:**
```python
from servers.models import Server

def custom_agents_view(request):
    servers_data = [
        {"id": s.id, "name": s.name, "host": s.host}
        for s in Server.objects.filter(user=request.user, is_active=True)
    ]
    template = get_template_name(request, "agent_hub/custom_agents.html")
    return render(request, template, {"servers_data": servers_data})
```

#### 1.6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –í–µ–±—Ö—É–∫–∏ –¥–ª—è –∞–≥–µ–Ω—Ç–æ–≤

**–®–∞–≥–∏:**
1. –°–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å `AgentWebhook`:
   ```python
   class AgentWebhook(models.Model):
       agent = models.ForeignKey(CustomAgent, on_delete=models.CASCADE, related_name='webhooks')
       url = models.URLField(help_text="URL –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ POST –ø—Ä–∏ —Ç—Ä–∏–≥–≥–µ—Ä–µ")
       secret = models.CharField(max_length=100, blank=True, help_text="–°–µ–∫—Ä–µ—Ç –¥–ª—è HMAC –ø–æ–¥–ø–∏—Å–∏")
       event_type = models.CharField(
           max_length=50,
           choices=[
               ('task_created', '–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏'),
               ('task_assigned', '–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏'),
               ('manual_trigger', '–†—É—á–Ω–æ–π —Ç—Ä–∏–≥–≥–µ—Ä'),
           ],
           default='manual_trigger'
       )
       is_active = models.BooleanField(default=True)
       created_at = models.DateTimeField(auto_now_add=True)
   ```
2. –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `agent_hub/migrations/0011_add_agent_webhooks.py`.
3. –î–æ–±–∞–≤–∏—Ç—å view –¥–ª—è –ø—Ä–∏—ë–º–∞ –≤–µ–±—Ö—É–∫–∞: `agent_hub/views_legacy.py`:
   ```python
   @csrf_exempt
   @require_http_methods(["POST"])
   def agent_webhook_trigger(request, agent_id: int):
       # –ù–∞–π—Ç–∏ –∞–≥–µ–Ω—Ç–∞, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–∫—Ä–µ—Ç (–µ—Å–ª–∏ –µ—Å—Ç—å), –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ –æ—á–µ—Ä–µ–¥—å
       # –ò–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å workflow —Å —ç—Ç–∏–º –∞–≥–µ–Ω—Ç–æ–º
       ...
   ```
4. URL: `path("api/agents/<int:agent_id>/webhook/", views.agent_webhook_trigger, name="agent_webhook_trigger")`.
5. UI: –≤ —Ñ–æ—Ä–º–µ Custom Agent –¥–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–µ–±—Ö—É–∫–∞ (URL, —Å–µ–∫—Ä–µ—Ç, —Å–æ–±—ã—Ç–∏–µ).

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í–µ–±—Ö—É–∫–∏ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–∏—á–∞, –º–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å –Ω–∞ –≤—Ç–æ—Ä—É—é —Ñ–∞–∑—É.

#### 1.7. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ —Å allowed_servers –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**–§–∞–π–ª:** `app/services/workflow_service.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `create_from_task`:**
- –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –∏–º–µ–µ—Ç `recommended_custom_agent_id` (—Å–º. –ó–∞–¥–∞—á—É 3), –∑–∞–≥—Ä—É–∑–∏—Ç—å CustomAgent –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ `allowed_servers` –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É.
- –í –ø—Ä–æ–º–ø—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É –ø–æ–¥—Å—Ç–∞–≤–ª—è—Ç—å knowledge_base –∞–≥–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å).

**–ü—Ä–∏–º–µ—Ä:**
```python
custom_agent = None
if task.recommended_custom_agent_id:
    custom_agent = CustomAgent.objects.filter(id=task.recommended_custom_agent_id, owner=user).first()

if custom_agent:
    # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–µ—Ä–æ–≤
    allowed_servers = custom_agent.get_allowed_servers(user)
    servers_context = [{"name": s.name, "host": s.host} for s in allowed_servers]
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ knowledge_base –≤ –ø—Ä–æ–º–ø—Ç
    knowledge = custom_agent.knowledge_base or ""
    task_text_with_knowledge = f"{task_text}\n\n--- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∞–≥–µ–Ω—Ç–∞ ---\n{knowledge}" if knowledge else task_text
```

#### 1.8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã:** `tests/test_custom_agents.py`

**–¢–µ—Å—Ç—ã:**
- `test_create_custom_agent_with_allowed_servers` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ —Å allowed_servers=["id1", "id2"].
- `test_create_custom_agent_all_servers` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ —Å allowed_servers=None (–≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã).
- `test_get_allowed_servers` ‚Äî –º–µ—Ç–æ–¥ `get_allowed_servers` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π QuerySet.
- `test_update_custom_agent_knowledge_base` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ knowledge_base —á–µ—Ä–µ–∑ API.
- `test_api_custom_agent_list_includes_servers` ‚Äî GET /api/custom-agents/ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç allowed_servers.
- `test_agent_with_invalid_server_ids` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è: –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ ID —Å–µ—Ä–≤–µ—Ä–æ–≤ –æ—Ç—Å–µ–∫–∞—é—Ç—Å—è.

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```bash
python manage.py test tests.test_custom_agents
```

---

## –ó–∞–¥–∞—á–∞ 2: –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏–∑ –≤–æ—Ä–∫—Ñ–ª–æ—É

### –¶–µ–ª—å

–£–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ `AgentProfile` –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É –∏–∑ –∑–∞–¥–∞—á–∏ (`api_assist_auto`) –∏ —Å–∫—Ä—ã—Ç—å —Å–µ–∫—Ü–∏—é "Profiles" —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≥–µ–Ω—Ç–æ–≤/–≤–æ—Ä–∫—Ñ–ª–æ—É. –ú–æ–¥–µ–ª—å `AgentProfile` –∏ API —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ `AgentRun`, —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—É—Å–∫–∏).

### –®–∞–≥–∏

#### 2.1. –ò–∑–º–µ–Ω–µ–Ω–∏–µ api_assist_auto (—É–¥–∞–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è)

**–§–∞–π–ª:** `agent_hub/views_legacy.py`

**–§—É–Ω–∫—Ü–∏—è:** `api_assist_auto` (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫ 3144‚Äì3238)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```python
@csrf_exempt
@login_required
@require_feature('agents')
@require_http_methods(["POST"])
def api_assist_auto(request):
    data = _parse_json_request(request)
    task = data.get("task", "").strip()
    # ... (–æ–±—Ä–∞–±–æ—Ç–∫–∞ runtime, project_path –∏ —Ç.–¥.) ...
    
    # –£–î–ê–õ–ò–¢–¨ –ò–õ–ò –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨:
    # action = data.get("action", "both")
    # profile_id = None
    # if action in ["profile", "both"]:
    #     cfg = _generate_profile_config(task)
    #     profile = AgentProfile.objects.create(...)
    #     profile_id = profile.id
    
    # –û–°–¢–ê–í–ò–¢–¨ –¢–û–õ–¨–ö–û:
    workflow_id = None
    run_id = None
    
    # –í—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë–º —Ç–æ–ª—å–∫–æ workflow (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º action "profile")
    script = _generate_workflow_script(task, runtime)
    if not script:
        return JsonResponse({"error": "Failed to generate workflow"}, status=500)
    
    workflow = AgentWorkflow.objects.create(
        owner=request.user,
        name=script.get("name", "New Workflow"),
        description=script.get("description", ""),
        runtime=script.get("runtime", runtime),
        script=script,
        project_path=project_path,
    )
    # ... (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ workflow) ...
    workflow_id = workflow.id
    
    if run_workflow:
        run = _start_workflow_run(workflow, request.user)
        run_id = run.id
    
    return JsonResponse({
        "success": True,
        "profile_id": None,  # –í—Å–µ–≥–¥–∞ null
        "workflow_id": workflow_id,
        "run_id": run_id
    })
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `api_assist_auto` –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç `AgentProfile`, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `profile_id: null`.

#### 2.2. –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ Profiles –∏–∑ agents.html

**–§–∞–π–ª:** `agent_hub/templates/agent_hub/agents.html`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ù–∞–π—Ç–∏ —Å–µ–∫—Ü–∏—é —Å id="profile-list" (–æ–∫–æ–ª–æ —Å—Ç—Ä–æ–∫ 245‚Äì272).
- –£–¥–∞–ª–∏—Ç—å –∏–ª–∏ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –±–ª–æ–∫:
  ```html
  <!-- –£–î–ê–õ–ò–¢–¨ –ò–õ–ò –ó–ê–ö–û–ú–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨:
  <div class="section-header">
      <h2 class="section-title">Profiles</h2>
      <button ...>Create profile</button>
  </div>
  <div id="profile-list" class="grid grid-cols-1 gap-3 ...">
      {% for profile in profiles %}
      ...
      {% endfor %}
  </div>
  -->
  ```
- –¢–∞–∫–∂–µ —É–¥–∞–ª–∏—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—è (–µ—Å–ª–∏ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–π —Å–µ–∫—Ü–∏–∏).
- –£–¥–∞–ª–∏—Ç—å JS —Ñ—É–Ω–∫—Ü–∏–∏ `runProfile`, `editProfile`, `saveProfile` (–µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö).

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –û—Å—Ç–∞–≤–∏—Ç—å AgentProfile –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤, –Ω–æ —Å–∫—Ä—ã—Ç—å UI —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–æ—Ä–∫—Ñ–ª–æ—É. –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª–∏ –Ω—É–∂–Ω—ã –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ü–µ–ª–µ–π (–Ω–µ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –≤–æ—Ä–∫—Ñ–ª–æ—É), –º–æ–∂–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏—Ö –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –∏–ª–∏ –≤–∫–ª–∞–¥–∫—É.

#### 2.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ agents_new.html (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª:** `agent_hub/templates/agent_hub/agents_new.html`

**–í–∞—Ä–∏–∞–Ω—Ç—ã:**
1. **–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ CustomAgent:** –í–º–µ—Å—Ç–æ —Å–ø–∏—Å–∫–∞ profiles –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ CustomAgent –¥–ª—è –≤—ã–±–æ—Ä–∞ –∞–≥–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º.
2. **–û—Å—Ç–∞–≤–∏—Ç—å profiles:** –ï—Å–ª–∏ profiles –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –≤–æ—Ä–∫—Ñ–ª–æ—É), –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å. –ù–æ —É–±—Ä–∞—Ç—å –∫–Ω–æ–ø–∫—É "New Agent" (—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è).
3. **–£–ø—Ä–æ—Å—Ç–∏—Ç—å:** –£–±—Ä–∞—Ç—å –≤—ã–±–æ—Ä –∞–≥–µ–Ω—Ç–∞ –≤–æ–æ–±—â–µ ‚Äî –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π –∞–≥–µ–Ω—Ç –∏–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ —Ñ–æ—Ä–º—ã.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ CustomAgent, –µ—Å–ª–∏ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤.

**–ò–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ–º –Ω–∞ CustomAgent):**
```html
<!-- –ë—ã–ª–æ: -->
{% for profile in profiles %}
    <div class="agent-card" data-agent-id="{{ profile.id }}">...</div>
{% endfor %}

<!-- –°—Ç–∞–ª–æ: -->
{% for agent in custom_agents %}
    <div class="agent-card" data-agent-id="{{ agent.id }}" data-agent-type="custom">...</div>
{% endfor %}
```

**–í `agent_hub/views/pages.py`:**
```python
def agents_page(request):
    # ...
    custom_agents = CustomAgent.objects.filter(owner=request.user, is_active=True)
    # ...
    return render(request, template, {
        # ...
        "custom_agents": custom_agents,
        # "profiles": profiles,  # –ú–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    })
```

**–í JS (agents_new.html):**
```javascript
// –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–ø—É—Å–∫–∞ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CustomAgent
function runAgent(agentId, isCustomAgent) {
    const url = isCustomAgent ? '/agents/api/custom-agents/run/' : '/agents/api/profiles/' + agentId + '/run/';
    // ...
}
```

#### 2.4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

**–§–∞–π–ª—ã:** `agent_hub/models.py`, `agent_hub/views_legacy.py`, `CLAUDE.md`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
  ```python
  # DEPRECATED: AgentProfile –±–æ–ª—å—à–µ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –∏–∑ –≤–æ—Ä–∫—Ñ–ª–æ—É.
  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å–æ —Å—Ç–∞—Ä—ã–º–∏ AgentRun.
  # –î–ª—è –Ω–æ–≤—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CustomAgent.
  ```
- –í `CLAUDE.md` –æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "Architecture" ‚Äî —É–∫–∞–∑–∞—Ç—å, —á—Ç–æ AgentProfile deprecated, –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–± ‚Äî CustomAgent.

#### 2.5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã:** `tests/test_workflow_no_profiles.py`

**–¢–µ—Å—Ç—ã:**
- `test_api_assist_auto_does_not_create_profile` ‚Äî POST /agents/api/assist-auto/ —Å –ª—é–±—ã–º action –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `profile_id: null` –∏ –Ω–µ —Å–æ–∑–¥–∞—ë—Ç AgentProfile.
- `test_workflow_created_without_profile` ‚Äî –≤–æ—Ä–∫—Ñ–ª–æ—É —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–µ–∑ —Å–≤—è–∑–∏ —Å profile.
- `test_agents_page_does_not_show_profiles` ‚Äî GET /agents/ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É –±–µ–∑ —Å–µ–∫—Ü–∏–∏ "Profiles" (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ id="profile-list" –≤ HTML).
- `test_old_agent_runs_still_accessible` ‚Äî —Å—Ç–∞—Ä—ã–µ AgentRun —Å profile FK –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```bash
python manage.py test tests.test_workflow_no_profiles
```

---

## –ó–∞–¥–∞—á–∞ 3: –õ–æ–≥–∏–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ —Å –ò–ò-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–º

### –¶–µ–ª—å

–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–≥–∏–∫—É –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–∞—á–∏:
- –ò–ò-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç **—Å–µ—Ä–≤–µ—Ä–æ–≤** –∏ **—Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤** (CustomAgent).
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –ò–ò –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É: –µ—Å—Ç—å –ª–∏ –Ω—É–∂–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã + –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∞–≥–µ–Ω—Ç.
- –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥: –Ω–µ –∑–∞—è–≤–ª—è—Ç—å –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–µ–∑ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏; –ø—Ä–∏ –Ω–µ—Ö–≤–∞—Ç–∫–µ –¥–∞–Ω–Ω—ã—Ö ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º.
- –í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö —É–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ (CustomAgent) –∏–ª–∏ —Ç–∏–ø (react/simple/complex/ralph).

### –®–∞–≥–∏

#### 3.1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—è –¥–ª—è —Å–≤—è–∑–∏ Task —Å CustomAgent

**–§–∞–π–ª:** `tasks/migrations/0010_add_custom_agent_to_task.py`

**–î–µ–π—Å—Ç–≤–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `recommended_custom_agent` –≤ `Task`:
  ```python
  recommended_custom_agent = models.ForeignKey(
      'agent_hub.CustomAgent',
      on_delete=models.SET_NULL,
      null=True,
      blank=True,
      related_name='tasks',
      help_text="–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–π –∫–∞—Å—Ç–æ–º–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏"
  )
  ```

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python manage.py makemigrations tasks --name add_custom_agent_to_task
python manage.py migrate
```

#### 3.2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SmartTaskAnalyzer –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∞–≥–µ–Ω—Ç–æ–≤

**–§–∞–π–ª:** `tasks/smart_analyzer.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `analyze_task`:**
```python
def analyze_task(self, task: Task, user: User) -> Dict[str, Any]:
    # ... (–∏–∑–≤–ª–µ—á–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ servers_context) ...
    
    # –ù–û–í–û–ï: –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ CustomAgent –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    from agent_hub.models import CustomAgent
    custom_agents = CustomAgent.objects.filter(owner=user, is_active=True)
    
    agents_context = []
    for agent in custom_agents:
        # –§–æ—Ä–º–∏—Ä—É–µ–º –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –ò–ò
        allowed_servers_desc = "–≤—Å–µ —Å–µ—Ä–≤–µ—Ä—ã"
        if agent.allowed_servers and isinstance(agent.allowed_servers, list):
            server_ids = agent.allowed_servers
            server_names = Server.objects.filter(id__in=server_ids, user=user).values_list('name', flat=True)
            allowed_servers_desc = ", ".join(server_names)
        
        agents_context.append({
            "id": agent.id,
            "name": agent.name,
            "description": agent.description,
            "instructions": agent.instructions[:200] if agent.instructions else "",  # –ö—Ä–∞—Ç–∫–æ–µ
            "allowed_tools": agent.allowed_tools,
            "allowed_servers": allowed_servers_desc,
            "runtime": agent.runtime,
        })
    
    # –í—ã–∑—ã–≤–∞–µ–º –ò–ò —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤
    ai_analysis = async_to_sync(self.ai_assistant.analyze_task)(
        task.title,
        task.description,
        servers_context=servers_context,
        agents_context=agents_context,  # –ù–û–í–û–ï
    )
    
    if ai_analysis.get('success') and ai_analysis.get('analysis'):
        analysis = ai_analysis['analysis']
        result['recommended_agent'] = analysis.get('recommended_agent', 'react')
        result['recommended_custom_agent_id'] = analysis.get('recommended_custom_agent_id')  # –ù–û–í–û–ï
        result['ai_reason'] = analysis.get('reason', '')
        # ...
        
        # –ù–û–í–û–ï: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –≤ Task
        if result['recommended_custom_agent_id']:
            try:
                task.recommended_custom_agent_id = result['recommended_custom_agent_id']
            except Exception as e:
                logger.warning(f"Failed to set recommended_custom_agent: {e}")
        
        task.ai_agent_type = result['recommended_agent']
        task.save()
        
        # ... (–æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π) ...
```

#### 3.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ TaskAIAssistant –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Å –∞–≥–µ–Ω—Ç–∞–º–∏

**–§–∞–π–ª:** `tasks/ai_assistant.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `analyze_task`:**
```python
async def analyze_task(
    self,
    task_title: str,
    task_description: str,
    servers_context: Optional[List[Dict[str, Any]]] = None,
    agents_context: Optional[List[Dict[str, Any]]] = None,  # –ù–û–í–û–ï
) -> Dict[str, Any]:
    try:
        import json
        import re
        model = model_manager.config.default_provider

        servers_text = ""
        if servers_context:
            parts = [f"- {s.get('name', '')} (—Ö–æ—Å—Ç: {s.get('host', '')}, –ø–æ—Ä—Ç: {s.get('port', 22)})" for s in servers_context]
            servers_text = f"–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n" + "\n".join(parts)
        else:
            servers_text = "–°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—É—Å—Ç ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –¥–æ–±–∞–≤–∏–ª —Å–µ—Ä–≤–µ—Ä—ã."
        
        # –ù–û–í–û–ï: –ö–æ–Ω—Ç–µ–∫—Å—Ç –∞–≥–µ–Ω—Ç–æ–≤
        agents_text = ""
        if agents_context:
            parts = []
            for agent in agents_context:
                agent_desc = f"- ID: {agent['id']}, –ò–º—è: {agent['name']}"
                if agent.get('description'):
                    agent_desc += f"\n  –û–ø–∏—Å–∞–Ω–∏–µ: {agent['description']}"
                if agent.get('instructions'):
                    agent_desc += f"\n  –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: {agent['instructions']}"
                if agent.get('allowed_tools'):
                    tools_str = ", ".join(agent['allowed_tools']) if isinstance(agent['allowed_tools'], list) else str(agent['allowed_tools'])
                    agent_desc += f"\n  –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã: {tools_str}"
                if agent.get('allowed_servers'):
                    agent_desc += f"\n  –î–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º: {agent['allowed_servers']}"
                agent_desc += f"\n  Runtime: {agent['runtime']}"
                parts.append(agent_desc)
            agents_text = f"–°–æ–∑–¥–∞–Ω–Ω—ã–µ –∞–≥–µ–Ω—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n" + "\n".join(parts)
        else:
            agents_text = "–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —Ç–∏–ø—ã (react, simple, complex, ralph)."

        prompt = f"""–¢—ã –ò–ò-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∑–∞–¥–∞—á. –¢–≤–æ—è —Ä–æ–ª—å ‚Äî –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –º–æ–∂–µ—Ç –ª–∏ –ò–ò –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É –Ω–∞ –æ—Å–Ω–æ–≤–µ –¢–û–õ–¨–ö–û –∏–º–µ—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö.

–ó–ê–î–ê–ß–ê: {task_title}
–û–ü–ò–°–ê–ù–ò–ï: {task_description}

{servers_text}

{agents_text}

–¢–í–û–ò –í–û–ó–ú–û–ñ–ù–û–°–¢–ò (–±–∞–∑–æ–≤—ã–µ):
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –ø–æ SSH –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥
- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ (apt, yum, pip)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —Å–µ—Ä–≤–∏—Å–æ–≤, –ª–æ–≥–æ–≤, –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∏ —Å–µ—Ä–≤–∏—Å–æ–≤

–û–ì–†–ê–ù–ò–ß–ï–ù–ò–Ø (–Ω—É–∂–Ω–æ —è–≤–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è):
- –£–¥–∞–ª–µ–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (rm -rf /, DROP DATABASE)
- –û—Ç–∫–ª—é—á–µ–Ω–∏–µ production-—Å–µ—Ä–≤–∏—Å–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π –∏ –∫–ª—é—á–µ–π –¥–æ—Å—Ç—É–ø–∞

–°–¢–†–û–ì–ò–ï –ü–†–ê–í–ò–õ–ê –ê–ù–ê–õ–ò–ó–ê:
1. –û–ø—Ä–µ–¥–µ–ª–∏, —É–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –≤ –∑–∞–¥–∞—á–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å–µ—Ä–≤–µ—Ä –∏–∑ —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö.
2. –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω —è–≤–Ω–æ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –ø–æ–Ω—è—Ç—å –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ω–∞ –ø—Ä–æ–¥–µ" –º–æ–∂–µ—Ç –æ–∑–Ω–∞—á–∞—Ç—å production —Å–µ—Ä–≤–µ—Ä).
3. –ü—Ä–æ–≤–µ—Ä—å, –µ—Å—Ç—å –ª–∏ —Å—Ä–µ–¥–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏ (–ø–æ –æ–ø–∏—Å–∞–Ω–∏—é, –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º, –¥–æ—Å—Ç—É–ø—É –∫ —Å–µ—Ä–≤–µ—Ä–∞–º).
4. –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∞–≥–µ–Ω—Ç –ò –Ω—É–∂–Ω—ã–π —Å–µ—Ä–≤–µ—Ä ‚Äî –º–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ. –£–∫–∞–∂–∏ ID –∞–≥–µ–Ω—Ç–∞ –≤ `recommended_custom_agent_id`.
5. –ï—Å–ª–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞ –Ω–µ—Ç, –Ω–æ –∑–∞–¥–∞—á–∞ —Ç–∏–ø–æ–≤–∞—è ‚Äî –º–æ–∂–µ—à—å –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø –∞–≥–µ–Ω—Ç–∞ (react/simple/complex/ralph).
6. –ï—Å–ª–∏ –ù–ï–¢ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (–Ω–µ—Ç –Ω—É–∂–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞, –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞, –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞ –∑–∞–¥–∞—á–∞) ‚Äî –ù–ï –ó–ê–Ø–í–õ–Ø–ô –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ:
   - –£—Å—Ç–∞–Ω–æ–≤–∏ `can_delegate_to_ai: false`
   - –£–∫–∞–∂–∏ –≤ `reason` –ø—Ä–∏—á–∏–Ω—É –æ—Ç–∫–∞–∑–∞
   - –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Äî –∑–∞–ø–æ–ª–Ω–∏ `missing_info`
7. –ï—Å–ª–∏ –∑–∞–¥–∞—á–∞ –æ–ø–∞—Å–Ω–∞—è (—É–¥–∞–ª–µ–Ω–∏–µ, –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ –∏ —Ç.–¥.) ‚Äî –ù–ï –ü–†–ï–î–õ–ê–ì–ê–ô –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —É—Å—Ç–∞–Ω–æ–≤–∏ `can_delegate_to_ai: false` –∏ —É–∫–∞–∂–∏ —Ä–∏—Å–∫–∏.

–í–µ—Ä–Ω–∏ —Å—Ç—Ä–æ–≥–æ JSON:
{{
    "can_delegate_to_ai": true –∏–ª–∏ false,
    "target_server_name": "–∏–º—è —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ –∏–ª–∏ null –µ—Å–ª–∏ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω",
    "recommended_custom_agent_id": ID –∞–≥–µ–Ω—Ç–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ (int) –∏–ª–∏ null,
    "recommended_agent": "react|simple|complex|ralph" (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ recommended_custom_agent_id null),
    "reason": "–ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä—É—Å—Å–∫–æ–º ‚Äî –ø–æ—á–µ–º—É –º–æ–∂–µ—à—å –∏–ª–∏ –Ω–µ –º–æ–∂–µ—à—å –≤—ã–ø–æ–ª–Ω–∏—Ç—å",
    "missing_info": "—á—Ç–æ –Ω—É–∂–Ω–æ —É—Ç–æ—á–Ω–∏—Ç—å —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ null)",
    "estimated_time": "–æ—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º",
    "complexity": "simple|medium|complex",
    "risks": "–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —Ä–∏—Å–∫–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∏–ª–∏ null)"
}}

–û—Ç–≤–µ—Ç (—Ç–æ–ª—å–∫–æ JSON):"""

        response_text = ""
        async for chunk in self.llm.stream_chat(prompt, model=model):
            response_text += chunk

        # –ü–∞—Ä—Å–∏–Ω–≥ JSON (–∫–∞–∫ –≤ –æ—Ä–∏–≥–∏–Ω–∞–ª–µ)
        json_match = re.search(r'\{[^{}]*\}', response_text, re.DOTALL)
        if not json_match:
            json_match = re.search(r'\{.*\}', response_text, re.DOTALL)
        if json_match:
            try:
                analysis = json.loads(json_match.group())
                if not isinstance(analysis.get('can_delegate_to_ai'), bool):
                    analysis['can_delegate_to_ai'] = False
                # –í–∞–ª–∏–¥–∞—Ü–∏—è recommended_custom_agent_id
                if analysis.get('recommended_custom_agent_id'):
                    if not isinstance(analysis['recommended_custom_agent_id'], int):
                        analysis['recommended_custom_agent_id'] = None
                return {
                    'success': True,
                    'analysis': analysis,
                    'raw_response': response_text
                }
            except json.JSONDecodeError:
                logger.debug("Failed to parse JSON analysis response.")

        return {
            'success': True,
            'analysis': {
                'can_delegate_to_ai': False,
                'reason': '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–æ–±—Ä–∞—Ç—å –æ—Ç–≤–µ—Ç –ò–ò.',
                'recommended_agent': 'react',
                'recommended_custom_agent_id': None,
                'estimated_time': '',
                'complexity': 'medium',
                'raw_analysis': response_text
            },
            'raw_response': response_text
        }

    except Exception as e:
        logger.error(f"Task analysis failed: {e}")
        return {
            'success': False,
            'error': str(e),
            'analysis': None
        }
```

#### 3.4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∞–≥–µ–Ω—Ç–∞

**–§–∞–π–ª:** `tasks/smart_analyzer.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `_create_auto_execution_notification`:**
```python
def _create_auto_execution_notification(
    self,
    task: Task,
    user: User,
    server_match: Dict[str, Any],
    analysis: Dict[str, Any] = None,
    available_servers: List[Dict[str, Any]] = None
):
    server = server_match['server']
    reason = (analysis or {}).get('reason', '')
    
    # –ù–û–í–û–ï: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∞–≥–µ–Ω—Ç–µ
    agent_info = ""
    custom_agent_id = (analysis or {}).get('recommended_custom_agent_id')
    if custom_agent_id:
        from agent_hub.models import CustomAgent
        agent = CustomAgent.objects.filter(id=custom_agent_id, owner=user).first()
        if agent:
            agent_info = f'ü§ñ –ê–≥–µ–Ω—Ç: **{agent.name}** ({agent.runtime})\n'
    
    message_parts = [
        f'üñ•Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω —Å–µ—Ä–≤–µ—Ä: **{server.name}** ({server.host})',
        f'üìã –ó–∞–¥–∞—á–∞: ¬´{task.title}¬ª',
        '',
    ]
    if agent_info:
        message_parts.append(agent_info)
    if reason:
        message_parts.append(f'‚úÖ {reason}')
    # ... (–æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
```

#### 3.5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É

**–§–∞–π–ª:** `app/services/workflow_service.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ `create_from_task`:**
```python
def create_from_task(task: "Task", user: "User") -> tuple["AgentWorkflow | None", "AgentWorkflowRun | None"]:
    # ... (–∑–∞–≥—Ä—É–∑–∫–∞ task_text, project_path, target_server) ...
    
    # –ù–û–í–û–ï: –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
    custom_agent = None
    if task.recommended_custom_agent_id:
        from agent_hub.models import CustomAgent
        custom_agent = CustomAgent.objects.filter(id=task.recommended_custom_agent_id, owner=user, is_active=True).first()
    
    # –ï—Å–ª–∏ –µ—Å—Ç—å custom_agent ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    if custom_agent:
        default_runtime = custom_agent.runtime
        # –§–∏–ª—å—Ç—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä—ã –ø–æ allowed_servers –∞–≥–µ–Ω—Ç–∞
        allowed_servers_qs = custom_agent.get_allowed_servers(user)
        if target_server and target_server not in allowed_servers_qs:
            logger.warning(f"Target server {target_server.name} not allowed for agent {custom_agent.name}")
            # –ú–æ–∂–Ω–æ –ª–∏–±–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å, –ª–∏–±–æ –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        
        # –î–æ–±–∞–≤–ª—è–µ–º knowledge_base –≤ –ø—Ä–æ–º–ø—Ç
        if custom_agent.knowledge_base:
            task_text += f"\n\n--- –ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –∞–≥–µ–Ω—Ç–∞ ---\n{custom_agent.knowledge_base}"
    else:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º default_runtime –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫
        default_runtime = model_manager.config.default_provider or "cursor"
    
    # ... (–æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ...
```

#### 3.6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ Task (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–§–∞–π–ª:** `tasks/models.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –†–∞—Å—à–∏—Ä–∏—Ç—å help_text –¥–ª—è `ai_agent_type`:
  ```python
  ai_agent_type = models.CharField(
      max_length=50, 
      blank=True, 
      null=True,
      help_text="–¢–∏–ø –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (react, simple, complex, ralph) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ recommended_custom_agent –Ω–µ –∑–∞–¥–∞–Ω"
  )
  ```

#### 3.7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

**–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã:** `tests/test_smart_task_analyzer.py`

**–¢–µ—Å—Ç—ã:**
- `test_analyzer_with_custom_agents` ‚Äî —Å–æ–∑–¥–∞—Ç—å CustomAgent, –∑–∞—Ç–µ–º –∑–∞–¥–∞—á—É; –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ analyze_task –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç recommended_custom_agent_id.
- `test_analyzer_without_custom_agents` ‚Äî –∑–∞–¥–∞—á–∞ –±–µ–∑ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –∞–≥–µ–Ω—Ç–æ–≤; –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ returned recommended_agent = react/simple/etc.
- `test_analyzer_no_server_no_agent` ‚Äî –∑–∞–¥–∞—á–∞ –±–µ–∑ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤; –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ can_delegate_to_ai=false, reason —É–∫–∞–∑–∞–Ω.
- `test_analyzer_with_missing_info` ‚Äî –∑–∞–¥–∞—á–∞ —Å –Ω–µ—Ö–≤–∞—Ç–∫–æ–π –¥–∞–Ω–Ω—ã—Ö; –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ missing_info –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –≤–æ–ø—Ä–æ—Å–æ–º —Å–æ–∑–¥–∞–Ω–æ.
- `test_notification_shows_agent_name` ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–º—è CustomAgent.
- `test_workflow_uses_custom_agent_runtime` ‚Äî –≤–æ—Ä–∫—Ñ–ª–æ—É —Å–æ–∑–¥–∞–Ω —Å runtime –∏–∑ CustomAgent.
- `test_workflow_includes_knowledge_base` ‚Äî task_text —Å–æ–¥–µ—Ä–∂–∏—Ç knowledge_base –∞–≥–µ–Ω—Ç–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É.

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```bash
python manage.py test tests.test_smart_task_analyzer
```

---

## –û–±—â–∏–π –ø–æ—Ä—è–¥–æ–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –§–∞–∑–∞ 1: –ó–∞–¥–∞—á–∞ 3 (–õ–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á)

**–¶–µ–ª—å:** –ù–∞–∏–±–æ–ª–µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ ‚Äî –∏–∑–º–µ–Ω—è–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–∞—á –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

**–®–∞–≥–∏:**
1. –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å `recommended_custom_agent` –≤ Task.
2. –û–±–Ω–æ–≤–∏—Ç—å SmartTaskAnalyzer –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ agents_context.
3. –û–±–Ω–æ–≤–∏—Ç—å TaskAIAssistant: –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å –∞–≥–µ–Ω—Ç–∞–º–∏ –∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏, –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥.
4. –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞.
5. –û–±–Ω–æ–≤–∏—Ç—å create_from_task: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CustomAgent –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É.
6. –ù–∞–ø–∏—Å–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –ò–ò –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å —É—á—ë—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤, –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### –§–∞–∑–∞ 2: –ó–∞–¥–∞—á–∞ 2 (–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏–∑ –≤–æ—Ä–∫—Ñ–ª–æ—É)

**–¶–µ–ª—å:** –£–ø—Ä–æ—Å—Ç–∏—Ç—å UI –∏ flow ‚Äî –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª–∏ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ—Ä–∫—Ñ–ª–æ—É.

**–®–∞–≥–∏:**
1. –ò–∑–º–µ–Ω–∏—Ç—å api_assist_auto: —É–±—Ä–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ profile.
2. –£–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ü–∏—é Profiles –∏–∑ agents.html.
3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –û–±–Ω–æ–≤–∏—Ç—å agents_new.html –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CustomAgent –≤–º–µ—Å—Ç–æ profiles.
4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é: AgentProfile deprecated.
5. –ù–∞–ø–∏—Å–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –í–æ—Ä–∫—Ñ–ª–æ—É —Å–æ–∑–¥–∞—é—Ç—Å—è –±–µ–∑ —Å–≤—è–∑–∏ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º, UI —á–∏—â–µ.

### –§–∞–∑–∞ 3: –ó–∞–¥–∞—á–∞ 1 (–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤)

**–¶–µ–ª—å:** –†–∞—Å—à–∏—Ä–∏—Ç—å CustomAgent —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–µ—Ä–≤–µ—Ä–∞–º, –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–µ–±—Ö—É–∫–∞–º–∏.

**–®–∞–≥–∏:**
1. –ú–∏–≥—Ä–∞—Ü–∏—è: –¥–æ–±–∞–≤–∏—Ç—å allowed_servers, knowledge_base –≤ CustomAgent.
2. –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å CustomAgent: –º–µ—Ç–æ–¥ get_allowed_servers.
3. –û–±–Ω–æ–≤–∏—Ç—å UI custom_agents.html: —Ñ–æ—Ä–º—ã –¥–ª—è –≤—ã–±–æ—Ä–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤, knowledge_base.
4. –û–±–Ω–æ–≤–∏—Ç—å API: —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ—Ç–¥–∞—á–∞ allowed_servers, knowledge_base.
5. –û–±–Ω–æ–≤–∏—Ç—å custom_agents_view: –ø–µ—Ä–µ–¥–∞—Ç—å servers_data –≤ —à–∞–±–ª–æ–Ω.
6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å AgentWebhook –∏ endpoint –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤.
7. –û–±–Ω–æ–≤–∏—Ç—å create_from_task –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è allowed_servers –∏ knowledge_base –∞–≥–µ–Ω—Ç–∞.
8. –ù–∞–ø–∏—Å–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã.

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** CustomAgent —Å –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π: –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π, –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º, MCP, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–µ–±—Ö—É–∫–∏.

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –æ—Ç–∫–∞—Ç–∞

### –†–∏—Å–∫–∏

1. **–ù–∞—Ä—É—à–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:** –°—Ç–∞—Ä—ã–µ AgentRun —Å profile FK –ø–µ—Ä–µ—Å—Ç–∞–Ω—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.
   - **–†–µ—à–µ–Ω–∏–µ:** –ù–µ —É–¥–∞–ª—è—Ç—å –º–æ–¥–µ–ª—å AgentProfile –∏ API, –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è —á—Ç–µ–Ω–∏—è. –í UI –ø–æ–º–µ—á–∞—Ç—å deprecated.

2. **–û—à–∏–±–∫–∏ –≤ –ø—Ä–æ–º–ø—Ç–µ –ò–ò:** –ù–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
   - **–†–µ—à–µ–Ω–∏–µ:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–∏–ø–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö, –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤ –ò–ò –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. Fallback: –µ—Å–ª–∏ –æ—Ç–≤–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω ‚Äî –≤–µ—Ä–Ω—É—Ç—å `can_delegate_to_ai=false`.

3. **–ü–æ–ª–æ–º–∫–∞ UI:** –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ü–∏–∏ Profiles –º–æ–∂–µ—Ç –Ω–∞—Ä—É—à–∏—Ç—å JS/CSS.
   - **–†–µ—à–µ–Ω–∏–µ:** –¢—â–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å agents.html –∏ agents_new.html –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ.

4. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ production:** –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ Task –∏ CustomAgent.
   - **–†–µ—à–µ–Ω–∏–µ:** –ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª—è—é—Ç nullable –ø–æ–ª—è, –±–µ–∑–æ–ø–∞—Å–Ω—ã. –ü–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π –Ω–∞ prod —Å–¥–µ–ª–∞—Ç—å –±—ç–∫–∞–ø –ë–î.

### –ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è:
1. **–û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π:**
   ```bash
   python manage.py migrate tasks 0009_add_jira_integration
   python manage.py migrate agent_hub 0009_add_custom_agents
   ```
2. **–û—Ç–∫–∞—Ç –∫–æ–¥–∞:** git revert –∫–æ–º–º–∏—Ç–æ–≤ –∏–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞.
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ UI:** –í–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ä—ã–µ —à–∞–±–ª–æ–Ω—ã agents.html –∏ agents_new.html –∏–∑ git –∏—Å—Ç–æ—Ä–∏–∏.

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã: `python manage.py test`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏: `python manage.py migrate --plan`
3. –í—Ä—É—á–Ω—É—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –∞–≥–µ–Ω—Ç–∞.
   - –°–æ–∑–¥–∞–Ω–∏–µ CustomAgent —Å allowed_servers, knowledge_base.
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ—Ä–∫—Ñ–ª–æ—É –∏–∑ –∑–∞–¥–∞—á–∏ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ profile –Ω–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è.
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ /agents/ ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ–∫—Ü–∏–∏ Profiles.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–¥–∞—á.

---

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∞–π–ª—ã

1. **[CLAUDE.md](CLAUDE.md):**
   - –°–µ–∫—Ü–∏—è "Architecture": –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ –∞–≥–µ–Ω—Ç–æ–≤ ‚Äî AgentProfile deprecated, CustomAgent ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±.
   - –°–µ–∫—Ü–∏—è "Key Patterns": –¥–æ–±–∞–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ flow –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–∞—á —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –∞–≥–µ–Ω—Ç–æ–≤ –∏ —Å–µ—Ä–≤–µ—Ä–æ–≤.

2. **[docs/ARCHITECTURE.md](docs/ARCHITECTURE.md):**
   - –î–∏–∞–≥—Ä–∞–º–º–∞: –¥–æ–±–∞–≤–∏—Ç—å —Å–≤—è–∑—å Task ‚Üí CustomAgent (recommended_custom_agent FK).
   - –û–ø–∏—Å–∞—Ç—å –Ω–æ–≤—ã–π flow —Å–æ–∑–¥–∞–Ω–∏—è –≤–æ—Ä–∫—Ñ–ª–æ—É –∏–∑ –∑–∞–¥–∞—á–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º CustomAgent.

3. **README.md:**
   - –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑–¥–µ–ª "Agents" —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–µ—Ä–≤–µ—Ä–∞–º –∏ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

4. **–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ñ–∞–π–ª:** `docs/AGENTS_GUIDE.md`
   - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –∞–≥–µ–Ω—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–µ—Ä–∞–º, –¥–æ–±–∞–≤–∏—Ç—å –±–∞–∑—É –∑–Ω–∞–Ω–∏–π, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≥–µ–Ω—Ç–∞ –¥–ª—è –∑–∞–¥–∞—á.

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### 1. UI —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è Custom Agents

- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–≤—å—é knowledge_base –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∞–≥–µ–Ω—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ.
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤ —Ä—è–¥–æ–º —Å –∏–º–µ–Ω–µ–º –∞–≥–µ–Ω—Ç–∞.
- –§–∏–ª—å—Ç—Ä –∞–≥–µ–Ω—Ç–æ–≤ –ø–æ runtime –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º.

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–Ω–∞–Ω–∏–π –∞–≥–µ–Ω—Ç–∞

- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∞–≥–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å, —á—Ç–æ knowledge_base –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, –∫–ª—é—á–∏ API).
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: "–ù–µ –¥–æ–±–∞–≤–ª—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏ –∏ —Å–µ–∫—Ä–µ—Ç—ã –≤ –±–∞–∑—É –∑–Ω–∞–Ω–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞—Ä–æ–ª–µ–π."

### 3. –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç –∞–≥–µ–Ω—Ç–æ–≤

- –ö–Ω–æ–ø–∫–∞ "–≠–∫—Å–ø–æ—Ä—Ç" –¥–ª—è CustomAgent ‚Üí —Å–∫–∞—á–∞—Ç—å JSON —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π (–±–µ–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).
- –ò–º–ø–æ—Ä—Ç –∞–≥–µ–Ω—Ç–∞ –∏–∑ JSON ‚Üí —Å–æ–∑–¥–∞—Ç—å CustomAgent –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∞–π–ª–∞.

### 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–≥–µ–Ω—Ç–æ–≤

- –ü–æ–ª–µ `usage_count` —É–∂–µ –µ—Å—Ç—å –≤ CustomAgent ‚Äî —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ.
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: —Ç–æ–ø –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤, —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (—á–µ—Ä–µ–∑ TaskExecution).

### 5. –í–µ–±—Ö—É–∫–∏ (–¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è)

- UI: —Ñ–æ—Ä–º–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–∞ (URL, —Å–µ–∫—Ä–µ—Ç, —Å–æ–±—ã—Ç–∏–µ).
- Backend: –ø—Ä–∏ —Å–æ–±—ã—Ç–∏–∏ (task_created, task_assigned) –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å POST –Ω–∞ URL —Å HMAC –ø–æ–¥–ø–∏—Å—å—é.
- Endpoint –¥–ª—è –ø—Ä–∏—ë–º–∞ –≤–µ–±—Ö—É–∫–∞: –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏ –≤ –æ—á–µ—Ä–µ–¥—å (Celery –∏–ª–∏ threading).

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–≠—Ç–æ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ç—Ä—ë—Ö –∫–ª—é—á–µ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π:
1. **–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ CustomAgent** —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Å–µ—Ä–≤–µ—Ä–∞–º, –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π –∏ –≤–µ–±—Ö—É–∫–∞–º–∏.
2. **–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π –∏–∑ –≤–æ—Ä–∫—Ñ–ª–æ—É** –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è UI –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.
3. **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ò–ò-–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –∑–∞–¥–∞—á** —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –∞–≥–µ–Ω—Ç–æ–≤.

–ü–æ—Ä—è–¥–æ–∫ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è (–§–∞–∑–∞ 1 ‚Üí 2 ‚Üí 3) –º–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç —Ä–∏—Å–∫–∏. –û—Ç–∫–∞—Ç –≤–æ–∑–º–æ–∂–µ–Ω —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ git revert. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–∫—Ä—ã–≤–∞—é—Ç—Å—è —Ç–µ—Å—Ç–∞–º–∏.

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—Å–µ—Ö —Ñ–∞–∑:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ—â–Ω—ã—Ö –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –¥–æ—Å—Ç—É–ø–∞ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.
- UI —Å—Ç–∞–Ω–µ—Ç —á–∏—â–µ –±–µ–∑ –ª–∏—à–Ω–∏—Ö –ø—Ä–æ—Ñ–∏–ª–µ–π –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–æ—Ä–∫—Ñ–ª–æ—É.
- –ó–∞–¥–∞—á–∏ –±—É–¥—É—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —É–º–Ω–µ–µ ‚Äî –ò–ò —á—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –º–æ–∂–µ—Ç –ª–∏ –æ–Ω –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–¥–∞—á—É, –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –∞–≥–µ–Ω—Ç–∞.

---

## –ß–µ–∫-–ª–∏—Å—Ç –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

- [ ] **–ó–∞–¥–∞—á–∞ 3 (–õ–æ–≥–∏–∫–∞ –∑–∞–¥–∞—á):**
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è: `0010_add_custom_agent_to_task.py`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `SmartTaskAnalyzer.analyze_task` (agents_context)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `TaskAIAssistant.analyze_task` (–Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç —Å –∞–≥–µ–Ω—Ç–∞–º–∏)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `create_from_task` (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CustomAgent)
  - [ ] –¢–µ—Å—Ç—ã: `test_smart_task_analyzer.py`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ ‚Üí –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- [ ] **–ó–∞–¥–∞—á–∞ 2 (–£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª–µ–π):**
  - [ ] –ò–∑–º–µ–Ω–∏—Ç—å `api_assist_auto` (–Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å profile)
  - [ ] –£–¥–∞–ª–∏—Ç—å —Å–µ–∫—Ü–∏—é Profiles –∏–∑ `agents.html`
  - [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –æ–±–Ω–æ–≤–∏—Ç—å `agents_new.html` –¥–ª—è CustomAgent
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (AgentProfile deprecated)
  - [ ] –¢–µ—Å—Ç—ã: `test_workflow_no_profiles.py`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ—Ä–∫—Ñ–ª–æ—É –Ω–µ —Å–æ–∑–¥–∞—ë—Ç profile, UI –±–µ–∑ Profiles

- [ ] **–ó–∞–¥–∞—á–∞ 1 (–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≥–µ–Ω—Ç–æ–≤):**
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏—è: `0010_add_agent_servers_knowledge.py`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–µ–ª—å `CustomAgent` (allowed_servers, knowledge_base)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å UI `custom_agents.html` (—Ñ–æ—Ä–º—ã –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤, –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å API `api_custom_agents_*` (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–æ—Ç–¥–∞—á–∞ –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π)
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `custom_agents_view` (–ø–µ—Ä–µ–¥–∞—Ç—å servers_data)
  - [ ] –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–¥–µ–ª—å `AgentWebhook` –∏ endpoint
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `create_from_task` (allowed_servers, knowledge_base)
  - [ ] –¢–µ—Å—Ç—ã: `test_custom_agents.py`
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ CustomAgent —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏ –∏ –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π

- [ ] **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `CLAUDE.md`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `docs/ARCHITECTURE.md`
  - [ ] –û–±–Ω–æ–≤–∏—Ç—å `README.md`
  - [ ] –°–æ–∑–¥–∞—Ç—å `docs/AGENTS_GUIDE.md`

- [ ] **–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:**
  - [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã: `python manage.py test`
  - [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–µ–∑ –æ—à–∏–±–æ–∫
  - [ ] –í—Ä—É—á–Ω—É—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å: –∑–∞–¥–∞—á–∏, –∞–≥–µ–Ω—Ç—ã, –≤–æ—Ä–∫—Ñ–ª–æ—É
  - [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫
  - [ ] –î–µ–ø–ª–æ–π –Ω–∞ staging ‚Üí –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Üí –¥–µ–ø–ª–æ–π –Ω–∞ production
